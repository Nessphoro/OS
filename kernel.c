/* This file has been generated by the Hex-Rays decompiler.
   Copyright (c) 2009 Hex-Rays <info@hex-rays.com>

   Detected compiler: GNU C++
*/

#include <defs.h>


//-------------------------------------------------------------------------
// Data declarations

extern _UNKNOWN GDT_Flush; // weak
extern int isr0[3]; // weak
extern char isr1; // weak
extern __int16 isr2; // weak
extern char isr3[3]; // weak
extern int isr4[3]; // weak
extern char isr5; // weak
extern __int16 isr6; // weak
extern char isr7[3]; // weak
extern int isr8[2]; // weak
extern __int16 isr9; // weak
extern char isr10[3]; // weak
extern char isr11; // weak
extern char isr12[3]; // weak
extern char isr13; // weak
extern char isr14[3]; // weak
extern char isr15; // weak
extern __int16 isr16; // weak
extern char isr17[3]; // weak
extern int isr18[3]; // weak
extern char isr19; // weak
extern __int16 isr20; // weak
extern char isr21[3]; // weak
extern int isr22[3]; // weak
extern char isr23; // weak
extern __int16 isr24; // weak
extern char isr25[3]; // weak
extern int isr26[3]; // weak
extern char isr27; // weak
extern __int16 isr28; // weak
extern char isr29[3]; // weak
extern int isr30[3]; // weak
extern char isr31; // weak
extern __int16 irq0; // weak
extern char irq1[3]; // weak
extern int irq2[3]; // weak
extern char irq3; // weak
extern __int16 irq4; // weak
extern char irq5[3]; // weak
extern int irq6[3]; // weak
extern char irq7; // weak
extern __int16 irq8; // weak
extern char irq9[3]; // weak
extern int irq10[3]; // weak
extern char irq11; // weak
extern __int16 irq12; // weak
extern char irq13[3]; // weak
extern int irq14[3]; // weak
extern char irq15; // weak
extern _UNKNOWN IndetityTable; // weak
extern char Keyboard__Keyboard_US[256]; // weak
extern char aKernel[7]; // weak
extern char aExit[5]; // weak
extern char aBlocking[9]; // weak
extern char aCrashLog[10]; // weak
extern char aIsr[4]; // weak
extern char aErrorNumber[14]; // weak
extern char aCr2[5]; // weak
extern char aEip[5]; // weak
extern char aInterruptRecie[20]; // weak
extern char a0x0[4]; // weak
extern char a0x[3]; // weak
extern char byte_C0108176[]; // weak
extern char aLogCreated[12]; // weak
extern char aNotLinked[14]; // weak
extern char aHeapAllocated[15]; // weak
extern char aAllSubsystemIn[26]; // weak
extern char aSuccesfulBoot[15]; // weak
extern char IDT__Pointer[6]; // weak
extern char IDT__Entries[2048]; // weak
extern char Log__Entries[200]; // weak
extern int Heap__Top; // weak
extern int Heap__End; // weak
extern int Heap__Start; // weak
extern char GDT__Pointer[6]; // weak
extern char GDT__Entries[24]; // weak
extern char KernelConsole[24]; // weak

//-------------------------------------------------------------------------
// Function declarations

void __cdecl loader();
void __cdecl StartInHigherHalf();
int Read_EIP(void); // weak
int __cdecl Tasking__InstallInternal(int a1, int a2, int a3);
// int __usercall Tasking__Install<eax>(int a1<ebp>);
char __cdecl Tasking__GetNextThread();
void __cdecl Tasking__Switch();
void __cdecl Tasking__CreateThread();
int __cdecl IRQ_Handler(int a1);
int __cdecl IDT__Install();
int __cdecl IDT__SetGate(int a1, unsigned int a2, __int16 a3, char a4);
int __cdecl IDT__InstallHandler(int a1, int a2);
int __cdecl IDT__UninstallHandler(int a1);
int __cdecl IDT__Flush();
int __cdecl IDT__INT_Handler(int a1);
int __cdecl IDT__IRQ_Handler(int a1);
int __cdecl IDT__GetRegisters();
int __cdecl Memory__Memory_Copy(int a1, int a2, int a3);
int __cdecl Memory__Memory_Set(int a1, int a2, int a3);
int __cdecl Memory__Memory_Set(int a1, __int16 a2, int a3);
int __cdecl Memory__Memory_Set(int a1, char a2, int a3);
int __cdecl Memory__Memory_Clear(int a1, int a2);
int __cdecl Memory__StaticMalloc(int a1);
int __cdecl Memory__StaticMalloc(int a1, char a2, int a3);
char __cdecl Globals__Inb(__int16 a1);
int __cdecl Globals__Outb(__int16 a1, char a2);
void __cdecl Globals__CLI();
void __cdecl Globals__STI();
int Globals__HLT(void); // weak
_DWORD __cdecl Console__Initialise_NoGraphics(_DWORD); // weak
int __cdecl Console__SetColor(int a1, char a2);
int __cdecl Console__Scroll(int a1);
// int __usercall Console__Write<eax>(int a1<eax>, unsigned __int8 a2<dl>);
int __cdecl Console__Write(int a3, unsigned __int8 a4);
_DWORD __cdecl Console__WriteLine(_DWORD); // weak
int __cdecl Console__Write(int a1, unsigned __int8 *a2);
char __cdecl Console__WriteSubsystem(int a1, unsigned __int8 *a2, unsigned __int8 *a3, int a4);
unsigned int __cdecl Console__WriteMiddle(int a1, int a2);
int __cdecl Console__WriteLine(int a3, unsigned __int8 *a4);
char __cdecl Console__WriteLineSubsystem(int a1, unsigned __int8 *a2, unsigned __int8 *a3, int a4);
_DWORD __cdecl Console__WriteNumber(_DWORD, _DWORD); // weak
int __cdecl Console__Clear(int a1);
int __cdecl Console__operator__(int a1, int a2);
int __cdecl Console__operator__(int a1, int *a2);
unsigned int __cdecl Log__Install();
_DWORD __cdecl Log__Write(_DWORD); // weak
int __cdecl Log__Read();
char __cdecl Log__Empty();
void __cdecl PIT__Handler();
int __cdecl PIT__Install();
int __cdecl PIT__Phase(unsigned int a1);
_DWORD __cdecl PIT__Sleep(_DWORD); // weak
int __cdecl PIT__Clocks();
int __cdecl String__StringLenght(int a1);
char __cdecl String__StringCompare(int a1, int a2);
int __cdecl String__FromString(int a1);
char __cdecl Heap__MemSortFunction(int a1, int a2);
int __cdecl Heap__Grow(int a1);
int __cdecl Heap__Shrink(int a1);
void __cdecl Heap__Free(int a1);
void __cdecl Heap__DeleteChunk(int a1);
void __cdecl Heap__Unlink(int a1);
_DWORD __cdecl Heap__Malloc(_DWORD); // weak
int __cdecl Heap__Link(int a1, int a2, int a3);
int __cdecl Heap__Setup();
int __cdecl Heap__Malloc_Allinged(int a1);
int __cdecl operator new(int a1);
int __cdecl operator new__(int a1);
int __cdecl Memory__Virtual__Switch(int a1);
_DWORD __cdecl Memory__Virtual__GetPage(_DWORD, char, _DWORD); // weak
int __cdecl Memory__Virtual__Install();
int __cdecl Memory__Virtual__SetFrame(unsigned int a1);
signed int __cdecl Memory__Virtual__ClearFrame(unsigned int a1);
char __cdecl Memory__Virtual__TestFrame(unsigned int a1);
int __cdecl Memory__Virtual__FirstFrame();
char __cdecl Memory__Virtual__AllocateFrame(int a1, char a2, char a3);
int __cdecl Memory__Virtual__FreeFrame(int a1);
int __cdecl Memory__Virtual__CreateCopy(int a1);
int __cdecl Memory__Virtual__LogicToPhysical(int a1, int a2);
int __cdecl GDT__Install();
int __cdecl GDT__SetGate(int a1, unsigned int a2, unsigned int a3, char a4, char a5);
int __cdecl GDT__Flush();
void __cdecl kmain();
void __cdecl Graphics__Initialise_NoGraphics();
_DWORD __cdecl Graphics__SetConsole(_DWORD); // weak
int __cdecl Graphics__GetConsole();
void __cdecl Graphics__RefreshConsole();
// char __usercall Keyboard__ToUpper<al>(int a1<eax>, char a2);
// char __usercall Keyboard__ToLower<al>(int a1<eax>, char a2);
char __cdecl Keyboard__ShiftUp(int a1);
int Keyboard__KeyboardHandler(); // weak
char __cdecl Keyboard__ReadKey();
char __cdecl Keyboard__ReadKeyInternal();
__int16 __cdecl Keyboard__ReadFullKey();
unsigned __int8 __cdecl Keyboard__ReadLine(int a1);
int __cdecl Keyboard__Install();


//----- (C010000C) --------------------------------------------------------
void __cdecl loader()
{
  v107000 = (unsigned int)((char *)&IndetityTable + 1073741824) | 3;
  v107c00 = (unsigned int)((char *)&IndetityTable + 1073741824) | 3;
  _ECX = 1077248;
  __asm
  {
    mov     cr3, ecx
    mov     ecx, cr0
  }
  _ECX |= 0x80000000u;
  __asm { mov     cr0, ecx }
  StartInHigherHalf();
}

//----- (C0100057) --------------------------------------------------------
void __cdecl StartInHigherHalf()
{
  v107000 = 0;
  kmain();
}

//----- (C0100352) --------------------------------------------------------
#error "FFFFFFFF: positive sp value has been found (funcsize=0)"

//----- (C01003E0) --------------------------------------------------------
int __cdecl Tasking__InstallInternal(int a1, int a2, int a3)
{
  unsigned int v3; // eax@1
  unsigned int v4; // edx@1
  int v5; // esi@1
  int v6; // eax@1
  int v7; // ebx@1
  int v8; // eax@1
  int v9; // eax@1
  int v10; // eax@1
  int v11; // edi@1
  int v12; // eax@1
  int v13; // eax@1
  int v14; // eax@1
  int v15; // ebx@2
  int v16; // eax@3
  int (__cdecl *v17)(int, int); // edx@3
  unsigned int v18; // ebx@4
  int v19; // edi@4
  int v20; // ecx@5
  int v21; // ebp@5
  int v22; // edx@7
  int result; // eax@13
  int v24; // eax@14
  int v25; // edx@14
  int v26; // [sp+18h] [bp-24h]@9
  int v27; // [sp+1Ch] [bp-20h]@1

  v6 = operator new(20);
  v7 = v6;
  *(_DWORD *)v6 = 0;
  *(_DWORD *)(v6 + 4) = 0;
  *(_DWORD *)(v6 + 8) = 0;
  *(_DWORD *)(v6 + 12) = 0;
  *(_DWORD *)(v6 + 16) = 0;
  v8 = operator new(32);
  v27 = v8;
  memset((void *)v8, 0, 0x20u);
  v9 = vc010cd6c;
  *(_DWORD *)(v7 + 4) = 0;
  *(_DWORD *)v7 = 1;
  *(_DWORD *)(v7 + 16) = "Kernel";
  *(_DWORD *)(v7 + 8) = v9;
  v10 = operator new(20);
  v11 = v10;
  *(_DWORD *)(v10 + 8) = 0;
  *(_DWORD *)(v10 + 12) = 4;
  *(_DWORD *)v10 = 0;
  *(_BYTE *)(v10 + 16) = 1;
  *(_DWORD *)(v10 + 4) = Heap__Malloc(16);
  v12 = *(_DWORD *)(v7 + 8);
  *(_DWORD *)(v7 + 12) = v11;
  *(_DWORD *)(v27 + 12) = v12;
  v13 = *(_DWORD *)(v7 + 4) + 1;
  *(_DWORD *)(v27 + 16) = v7;
  *(_DWORD *)(v27 + 4) = 0;
  *(_BYTE *)(v27 + 21) = 0;
  *(_BYTE *)(v27 + 20) = 0;
  *(_BYTE *)(v27 + 24) = 1;
  *(_DWORD *)(v7 + 4) = v13;
  *(_DWORD *)v27 = v13;
  v14 = operator new(76);
  memset((void *)v14, 0, 0x4Cu);
  v5 = *(_DWORD *)(v7 + 12);
  *(_DWORD *)(v27 + 8) = v14;
  *(_DWORD *)(v14 + 56) = a1;
  *(_DWORD *)(v14 + 68) = a2;
  *(_DWORD *)(v14 + 24) = a3;
  *(_DWORD *)(v14 + 64) = 514;
  *(_DWORD *)(v14 + 60) = 8;
  *(_DWORD *)(v14 + 12) = 16;
  *(_DWORD *)(v14 + 8) = 16;
  *(_DWORD *)(v14 + 4) = 16;
  *(_DWORD *)v14 = 16;
  *(_DWORD *)(v14 + 72) = 16;
  v3 = *(_DWORD *)(v5 + 8);
  v4 = *(_DWORD *)(v5 + 12);
  if ( v3 >= v4 )
  {
    v25 = (v4 >> 1) + v4;
    *(_DWORD *)(v5 + 12) = v25;
    v15 = Heap__Malloc(4 * v25);
    Memory__Memory_Copy(v15, *(_DWORD *)(v5 + 4), 4 * *(_DWORD *)(v5 + 8));
    v24 = *(_DWORD *)(v5 + 4);
    *(_DWORD *)(v5 + 4) = v15;
    if ( *(_BYTE *)(v5 + 16) )
    {
      Heap__Free(v24);
      v15 = *(_DWORD *)(v5 + 4);
      v3 = *(_DWORD *)(v5 + 8);
    }
    else
    {
      *(_BYTE *)(v5 + 16) = 1;
      v3 = *(_DWORD *)(v5 + 8);
    }
  }
  else
  {
    v15 = *(_DWORD *)(v5 + 4);
  }
  *(_DWORD *)(v15 + 4 * v3) = v27;
  v16 = v3 + 1;
  v17 = *(int (__cdecl **)(int, int))v5;
  *(_DWORD *)(v5 + 8) = v16;
  if ( v17 )
  {
    v19 = 0;
    v18 = 0;
    while ( v18 < v16 - 1 )
    {
      v21 = 0;
      v20 = *(_DWORD *)(v5 + 4);
      if ( v16 > v18 )
        v21 = *(_DWORD *)(v20 + v19);
      ++v18;
      v22 = 0;
      if ( v16 > v18 )
        v22 = *(_DWORD *)(v20 + 4 * v18);
      v26 = v22;
      if ( !(unsigned __int8)(*(int (__cdecl **)(int, int))v5)(v21, v22) )
      {
        *(_DWORD *)(*(_DWORD *)(v5 + 4) + v19) = v26;
        *(_DWORD *)(*(_DWORD *)(v5 + 4) + 4 * v18) = v21;
      }
      v16 = *(_DWORD *)(v5 + 8);
      v19 += 4;
    }
  }
  result = v27;
  IDT__Entries[128] = 1;
  *(_DWORD *)&IDT__Entries[140] = result;
  *(_DWORD *)(result + 28) = result;
  return result;
}
// C0102D00: using guessed type _DWORD __cdecl Heap__Malloc(_DWORD);

//----- (C0100600) --------------------------------------------------------
int __usercall Tasking__Install<eax>(int a1<ebp>)
{
  int result; // eax@1
  int v2; // [sp+0h] [bp-1Ch]@3

  result = Read_EIP();
  if ( !IDT__Entries[128] )
  {
    Tasking__InstallInternal(result, (int)&v2, a1);
    while ( 1 )
      ;
  }
  Keyboard__Keyboard_US[224] = 0;
  return result;
}
// C0100352: using guessed type int Read_EIP(void);

//----- (C0100650) --------------------------------------------------------
char __cdecl Tasking__GetNextThread()
{
  int v0; // ebx@1
  int v1; // eax@1
  char v2; // zf@1
  int v3; // eax@2
  char result; // al@4
  int v5; // ebx@9
  int v6; // eax@9

  v0 = *(_DWORD *)&IDT__Entries[140];
  v1 = IDT__GetRegisters();
  v2 = Keyboard__Keyboard_US[224] == 0;
  *(_DWORD *)(v0 + 4) = v1;
  if ( !v2 )
  {
    v5 = *(_DWORD *)(*(_DWORD *)&IDT__Entries[140] + 8);
    v6 = IDT__GetRegisters();
    Memory__Memory_Copy(v6, v5, 76);
  }
  v3 = IDT__GetRegisters();
  Memory__Memory_Copy(*(_DWORD *)(*(_DWORD *)&IDT__Entries[140] + 8), v3, 76);
  for ( ;
        *(_BYTE *)(*(_DWORD *)(*(_DWORD *)&IDT__Entries[140] + 28) + 21);
        *(_DWORD *)(*(_DWORD *)&IDT__Entries[140] + 28) = *(_DWORD *)(*(_DWORD *)(*(_DWORD *)&IDT__Entries[140] + 28)
                                                                    + 28) )
    Console__WriteLine((int)KernelConsole, (unsigned __int8 *)"Exit");
  while ( 1 )
  {
    *(_DWORD *)&IDT__Entries[140] = *(_DWORD *)(*(_DWORD *)&IDT__Entries[140] + 28);
    result = *(_BYTE *)(*(_DWORD *)&IDT__Entries[140] + 20);
    if ( !result )
      break;
    Console__WriteLine((int)KernelConsole, (unsigned __int8 *)"Blocking");
    for ( ;
          *(_BYTE *)(*(_DWORD *)(*(_DWORD *)&IDT__Entries[140] + 28) + 21);
          *(_DWORD *)(*(_DWORD *)&IDT__Entries[140] + 28) = *(_DWORD *)(*(_DWORD *)(*(_DWORD *)&IDT__Entries[140] + 28)
                                                                      + 28) )
      ;
  }
  return result;
}

//----- (C0100780) --------------------------------------------------------
void __cdecl Tasking__Switch()
{
  if ( IDT__Entries[128] )
    IDT__Entries[136] = 1;
}

//----- (C01007A0) --------------------------------------------------------
void __cdecl Tasking__CreateThread()
{
  unsigned int v0; // eax@1
  unsigned int v1; // edx@1
  int v2; // ebx@1
  int v3; // esi@1
  int v4; // eax@1
  int v5; // edx@1
  int v6; // eax@1
  int v7; // edi@2
  int v8; // eax@3
  int (__cdecl *v9)(int, int); // ecx@3
  int v10; // ecx@4
  unsigned int v11; // edi@4
  int v12; // edx@5
  int v13; // ebx@5
  int v14; // ebp@7
  int v15; // eax@14
  int v16; // ebp@14
  int v17; // esi@14
  int v18; // eax@14
  int v19; // eax@14
  int v20; // edx@14
  int v21; // edx@14
  int v22; // edi@16
  int v23; // eax@16
  int v24; // eax@19
  int v25; // edx@19
  int v26; // [sp+18h] [bp-24h]@9
  int v27; // [sp+1Ch] [bp-20h]@4

  Memory__Virtual__Switch(vc010cd6c);
  v2 = operator new(32);
  memset((void *)v2, 0, 0x20u);
  *(_DWORD *)(v2 + 16) = *(_DWORD *)(*(_DWORD *)&IDT__Entries[140] + 16);
  *(_DWORD *)(v2 + 12) = Memory__Virtual__CreateCopy(*(_DWORD *)(*(_DWORD *)(*(_DWORD *)&IDT__Entries[140] + 16) + 8));
  v4 = *(_DWORD *)&IDT__Entries[140];
  *(_BYTE *)(v2 + 21) = 0;
  *(_BYTE *)(v2 + 20) = 0;
  v5 = *(_DWORD *)(v4 + 16);
  *(_BYTE *)(v2 + 24) = 1;
  v6 = *(_DWORD *)(v5 + 4) + 1;
  *(_DWORD *)(v5 + 4) = v6;
  *(_DWORD *)v2 = v6;
  v3 = *(_DWORD *)(*(_DWORD *)(v2 + 16) + 12);
  v0 = *(_DWORD *)(v3 + 8);
  v1 = *(_DWORD *)(v3 + 12);
  if ( v0 >= v1 )
  {
    v25 = (v1 >> 1) + v1;
    *(_DWORD *)(v3 + 12) = v25;
    v7 = Heap__Malloc(4 * v25);
    Memory__Memory_Copy(v7, *(_DWORD *)(v3 + 4), 4 * *(_DWORD *)(v3 + 8));
    v24 = *(_DWORD *)(v3 + 4);
    *(_DWORD *)(v3 + 4) = v7;
    if ( !*(_BYTE *)(v3 + 16) )
    {
      *(_BYTE *)(v3 + 16) = 1;
      v0 = *(_DWORD *)(v3 + 8);
LABEL_3:
      *(_DWORD *)(v7 + 4 * v0) = v2;
      v8 = v0 + 1;
      v9 = *(int (__cdecl **)(int, int))v3;
      *(_DWORD *)(v3 + 8) = v8;
      if ( v9 )
      {
        v10 = 0;
        v11 = 0;
        v27 = v2;
        while ( v11 < v8 - 1 )
        {
          v13 = 0;
          v12 = *(_DWORD *)(v3 + 4);
          if ( v8 > v11 )
            v13 = *(_DWORD *)(v12 + v10);
          ++v11;
          v14 = 0;
          if ( v8 > v11 )
            v14 = *(_DWORD *)(v12 + 4 * v11);
          v26 = v10;
          if ( !(unsigned __int8)(*(int (__cdecl **)(int, int))v3)(v13, v14) )
          {
            *(_DWORD *)(*(_DWORD *)(v3 + 4) + v26) = v14;
            *(_DWORD *)(*(_DWORD *)(v3 + 4) + 4 * v11) = v13;
          }
          v8 = *(_DWORD *)(v3 + 8);
          v10 = v26 + 4;
        }
        v2 = v27;
      }
      v18 = Memory__Virtual__GetPage(4096, 1, *(_DWORD *)(v2 + 12));
      Memory__Virtual__AllocateFrame(v18, 0, 1);
      v19 = Memory__Virtual__GetPage(8192, 1, *(_DWORD *)(v2 + 12));
      Memory__Virtual__AllocateFrame(v19, 0, 1);
      v17 = Memory__Virtual__GetPage(12288, 1, *(_DWORD *)(v2 + 12));
      v16 = Memory__Virtual__GetPage(16384, 1, *(_DWORD *)(v2 + 12));
      Memory__Virtual__AllocateFrame(v17, 1, 1);
      Memory__Virtual__AllocateFrame(v16, 1, 1);
      v20 = operator new(76);
      memset((void *)v20, 0, 0x4Cu);
      *(_DWORD *)(v2 + 8) = v20;
      Memory__Memory_Clear(v20, 76);
      v15 = *(_DWORD *)(v2 + 8);
      v21 = *(_DWORD *)(v2 + 16);
      *(_DWORD *)(v15 + 56) = -559038242;
      *(_DWORD *)(v15 + 64) = 514;
      *(_DWORD *)(v15 + 68) = 8192;
      if ( *(_DWORD *)v21 == 1 )
      {
        *(_DWORD *)(v15 + 60) = 8;
        *(_DWORD *)(v15 + 72) = 16;
        *(_DWORD *)v15 = 16;
        *(_DWORD *)(v15 + 4) = 16;
        *(_DWORD *)(v15 + 8) = 16;
        *(_DWORD *)(v15 + 12) = 16;
      }
      else
      {
        *(_DWORD *)(v15 + 60) = 27;
        *(_DWORD *)(v15 + 72) = 35;
        *(_DWORD *)v15 = 35;
        *(_DWORD *)(v15 + 4) = 35;
        *(_DWORD *)(v15 + 8) = 35;
        *(_DWORD *)(v15 + 12) = 35;
      }
      *(_DWORD *)(v2 + 4) = 16308;
      v22 = Memory__Virtual__GetPage(0, 1, vc010cd6c);
      v23 = Memory__Virtual__GetPage(4096, 1, vc010cd6c);
      *(_DWORD *)v22 = *(_DWORD *)v17 & 0xFFFFF000 | *(_DWORD *)v22 & 0xFFF;
      *(_DWORD *)v23 = *(_DWORD *)v16 & 0xFFFFF000 | *(_DWORD *)v23 & 0xFFF;
      *(_BYTE *)v22 |= 1u;
      *(_BYTE *)v23 |= 1u;
      *(_BYTE *)v22 &= 0xFBu;
      *(_BYTE *)v23 &= 0xFBu;
      Memory__Memory_Copy(4020, *(_DWORD *)(v2 + 8), 76);
      Console__WriteNumber(KernelConsole, v10ec);
      Console__WriteNumber(KernelConsole, v10ed);
      Console__WriteNumber(KernelConsole, v10ee);
      Console__WriteNumber(KernelConsole, v10ef);
      Graphics__RefreshConsole();
      while ( 1 )
        ;
    }
    Heap__Free(v24);
    v0 = *(_DWORD *)(v3 + 8);
  }
  v7 = *(_DWORD *)(v3 + 4);
  goto LABEL_3;
}
// C0101D10: using guessed type _DWORD __cdecl Console__WriteNumber(_DWORD, _DWORD);
// C0102D00: using guessed type _DWORD __cdecl Heap__Malloc(_DWORD);
// C01038A0: using guessed type _DWORD __cdecl Memory__Virtual__GetPage(_DWORD, char, _DWORD);

//----- (C0100B60) --------------------------------------------------------
int __cdecl IRQ_Handler(int a1)
{
  unsigned int v1; // eax@1
  void (*v2)(void); // edx@1

  *(_DWORD *)&IDT__Entries[224] = a1;
  v1 = *(_DWORD *)(a1 + 48);
  v2 = *(void (**)(void))(4 * v1 - 1072643456);
  if ( v2 )
  {
    v2();
    v1 = *(_DWORD *)(a1 + 48);
  }
  if ( v1 > 0x27 )
    Globals__Outb(160, 32);
  return Globals__Outb(32, 32);
}

//----- (C0100BC0) --------------------------------------------------------
int __cdecl IDT__Install()
{
  int result; // eax@1

  Globals__Outb(32, 17);
  Globals__Outb(160, 17);
  Globals__Outb(33, 32);
  Globals__Outb(161, 40);
  Globals__Outb(33, 4);
  Globals__Outb(161, 2);
  Globals__Outb(33, 1);
  Globals__Outb(161, 1);
  Globals__Outb(33, 0);
  Globals__Outb(161, 0);
  *(_WORD *)&IDT__Entries[228] = 2047;
  *(_WORD *)&IDT__Entries[256] = (unsigned int)isr0;
  *(_DWORD *)&IDT__Entries[230] = IDT__Entries;
  *(_WORD *)&IDT__Entries[258] = 8;
  *(_WORD *)&IDT__Entries[262] = (unsigned int)isr0 >> 16;
  *(_WORD *)&IDT__Entries[264] = (unsigned int)&isr1;
  IDT__Entries[260] = 0;
  IDT__Entries[261] = -114;
  *(_WORD *)&IDT__Entries[270] = (unsigned int)&isr1 >> 16;
  *(_WORD *)&IDT__Entries[272] = (unsigned int)&isr2;
  *(_WORD *)&IDT__Entries[266] = 8;
  IDT__Entries[268] = 0;
  *(_WORD *)&IDT__Entries[278] = (unsigned int)&isr2 >> 16;
  *(_WORD *)&IDT__Entries[280] = (unsigned int)isr3;
  IDT__Entries[269] = -114;
  *(_WORD *)&IDT__Entries[274] = 8;
  *(_WORD *)&IDT__Entries[286] = (unsigned int)isr3 >> 16;
  *(_WORD *)&IDT__Entries[288] = (unsigned int)isr4;
  IDT__Entries[276] = 0;
  IDT__Entries[277] = -114;
  *(_WORD *)&IDT__Entries[294] = (unsigned int)isr4 >> 16;
  *(_WORD *)&IDT__Entries[296] = (unsigned int)&isr5;
  *(_WORD *)&IDT__Entries[282] = 8;
  IDT__Entries[284] = 0;
  *(_WORD *)&IDT__Entries[302] = (unsigned int)&isr5 >> 16;
  *(_WORD *)&IDT__Entries[304] = (unsigned int)&isr6;
  IDT__Entries[285] = -114;
  *(_WORD *)&IDT__Entries[290] = 8;
  IDT__Entries[292] = 0;
  IDT__Entries[293] = -114;
  *(_WORD *)&IDT__Entries[298] = 8;
  IDT__Entries[300] = 0;
  IDT__Entries[301] = -114;
  *(_WORD *)&IDT__Entries[310] = (unsigned int)&isr6 >> 16;
  *(_WORD *)&IDT__Entries[306] = 8;
  *(_WORD *)&IDT__Entries[312] = (unsigned int)isr7;
  IDT__Entries[308] = 0;
  IDT__Entries[309] = -114;
  *(_WORD *)&IDT__Entries[318] = (unsigned int)isr7 >> 16;
  *(_WORD *)&IDT__Entries[320] = (unsigned int)isr8;
  *(_WORD *)&IDT__Entries[314] = 8;
  IDT__Entries[316] = 0;
  *(_WORD *)&IDT__Entries[326] = (unsigned int)isr8 >> 16;
  *(_WORD *)&IDT__Entries[328] = (unsigned int)&isr9;
  IDT__Entries[317] = -114;
  *(_WORD *)&IDT__Entries[322] = 8;
  *(_WORD *)&IDT__Entries[334] = (unsigned int)&isr9 >> 16;
  *(_WORD *)&IDT__Entries[336] = (unsigned int)isr10;
  IDT__Entries[324] = 0;
  IDT__Entries[325] = -114;
  *(_WORD *)&IDT__Entries[342] = (unsigned int)isr10 >> 16;
  *(_WORD *)&IDT__Entries[344] = (unsigned int)&isr11;
  *(_WORD *)&IDT__Entries[330] = 8;
  IDT__Entries[332] = 0;
  *(_WORD *)&IDT__Entries[350] = (unsigned int)&isr11 >> 16;
  *(_WORD *)&IDT__Entries[352] = (unsigned int)isr12;
  IDT__Entries[333] = -114;
  *(_WORD *)&IDT__Entries[338] = 8;
  *(_WORD *)&IDT__Entries[358] = (unsigned int)isr12 >> 16;
  IDT__Entries[340] = 0;
  IDT__Entries[341] = -114;
  *(_WORD *)&IDT__Entries[346] = 8;
  IDT__Entries[348] = 0;
  IDT__Entries[349] = -114;
  *(_WORD *)&IDT__Entries[354] = 8;
  IDT__Entries[356] = 0;
  IDT__Entries[357] = -114;
  *(_WORD *)&IDT__Entries[360] = (unsigned int)&isr13;
  *(_WORD *)&IDT__Entries[362] = 8;
  IDT__Entries[364] = 0;
  *(_WORD *)&IDT__Entries[366] = (unsigned int)&isr13 >> 16;
  *(_WORD *)&IDT__Entries[368] = (unsigned int)isr14;
  IDT__Entries[365] = -114;
  *(_WORD *)&IDT__Entries[370] = 8;
  *(_WORD *)&IDT__Entries[374] = (unsigned int)isr14 >> 16;
  *(_WORD *)&IDT__Entries[376] = (unsigned int)&isr15;
  IDT__Entries[372] = 0;
  IDT__Entries[373] = -114;
  *(_WORD *)&IDT__Entries[382] = (unsigned int)&isr15 >> 16;
  *(_WORD *)&IDT__Entries[384] = (unsigned int)&isr16;
  *(_WORD *)&IDT__Entries[378] = 8;
  IDT__Entries[380] = 0;
  *(_WORD *)&IDT__Entries[390] = (unsigned int)&isr16 >> 16;
  *(_WORD *)&IDT__Entries[392] = (unsigned int)isr17;
  IDT__Entries[381] = -114;
  *(_WORD *)&IDT__Entries[386] = 8;
  *(_WORD *)&IDT__Entries[398] = (unsigned int)isr17 >> 16;
  *(_WORD *)&IDT__Entries[400] = (unsigned int)isr18;
  IDT__Entries[388] = 0;
  IDT__Entries[389] = -114;
  *(_WORD *)&IDT__Entries[406] = (unsigned int)isr18 >> 16;
  *(_WORD *)&IDT__Entries[408] = (unsigned int)&isr19;
  *(_WORD *)&IDT__Entries[394] = 8;
  IDT__Entries[396] = 0;
  *(_WORD *)&IDT__Entries[414] = (unsigned int)&isr19 >> 16;
  IDT__Entries[397] = -114;
  *(_WORD *)&IDT__Entries[402] = 8;
  IDT__Entries[404] = 0;
  IDT__Entries[405] = -114;
  *(_WORD *)&IDT__Entries[410] = 8;
  IDT__Entries[412] = 0;
  IDT__Entries[413] = -114;
  *(_WORD *)&IDT__Entries[416] = (unsigned int)&isr20;
  *(_WORD *)&IDT__Entries[418] = 8;
  *(_WORD *)&IDT__Entries[422] = (unsigned int)&isr20 >> 16;
  *(_WORD *)&IDT__Entries[424] = (unsigned int)isr21;
  IDT__Entries[420] = 0;
  IDT__Entries[421] = -114;
  *(_WORD *)&IDT__Entries[430] = (unsigned int)isr21 >> 16;
  *(_WORD *)&IDT__Entries[432] = (unsigned int)isr22;
  *(_WORD *)&IDT__Entries[426] = 8;
  IDT__Entries[428] = 0;
  *(_WORD *)&IDT__Entries[438] = (unsigned int)isr22 >> 16;
  *(_WORD *)&IDT__Entries[440] = (unsigned int)&isr23;
  IDT__Entries[429] = -114;
  *(_WORD *)&IDT__Entries[434] = 8;
  *(_WORD *)&IDT__Entries[446] = (unsigned int)&isr23 >> 16;
  *(_WORD *)&IDT__Entries[448] = (unsigned int)&isr24;
  IDT__Entries[436] = 0;
  IDT__Entries[437] = -114;
  *(_WORD *)&IDT__Entries[454] = (unsigned int)&isr24 >> 16;
  *(_WORD *)&IDT__Entries[456] = (unsigned int)isr25;
  *(_WORD *)&IDT__Entries[442] = 8;
  IDT__Entries[444] = 0;
  *(_WORD *)&IDT__Entries[462] = (unsigned int)isr25 >> 16;
  *(_WORD *)&IDT__Entries[464] = (unsigned int)isr26;
  IDT__Entries[445] = -114;
  *(_WORD *)&IDT__Entries[450] = 8;
  *(_WORD *)&IDT__Entries[470] = (unsigned int)isr26 >> 16;
  IDT__Entries[452] = 0;
  IDT__Entries[453] = -114;
  *(_WORD *)&IDT__Entries[458] = 8;
  IDT__Entries[460] = 0;
  IDT__Entries[461] = -114;
  *(_WORD *)&IDT__Entries[466] = 8;
  IDT__Entries[468] = 0;
  *(_WORD *)&IDT__Entries[472] = (unsigned int)&isr27;
  IDT__Entries[469] = -114;
  *(_WORD *)&IDT__Entries[478] = (unsigned int)&isr27 >> 16;
  *(_WORD *)&IDT__Entries[480] = (unsigned int)&isr28;
  *(_WORD *)&IDT__Entries[474] = 8;
  IDT__Entries[476] = 0;
  *(_WORD *)&IDT__Entries[486] = (unsigned int)&isr28 >> 16;
  *(_WORD *)&IDT__Entries[488] = (unsigned int)isr29;
  IDT__Entries[477] = -114;
  *(_WORD *)&IDT__Entries[482] = 8;
  *(_WORD *)&IDT__Entries[494] = (unsigned int)isr29 >> 16;
  *(_WORD *)&IDT__Entries[496] = (unsigned int)isr30;
  IDT__Entries[484] = 0;
  IDT__Entries[485] = -114;
  *(_WORD *)&IDT__Entries[502] = (unsigned int)isr30 >> 16;
  *(_WORD *)&IDT__Entries[504] = (unsigned int)&isr31;
  *(_WORD *)&IDT__Entries[490] = 8;
  IDT__Entries[492] = 0;
  *(_WORD *)&IDT__Entries[510] = (unsigned int)&isr31 >> 16;
  *(_WORD *)&IDT__Entries[512] = (unsigned int)&irq0;
  IDT__Entries[493] = -114;
  *(_WORD *)&IDT__Entries[498] = 8;
  *(_WORD *)&IDT__Entries[518] = (unsigned int)&irq0 >> 16;
  *(_WORD *)&IDT__Entries[520] = (unsigned int)irq1;
  IDT__Entries[500] = 0;
  IDT__Entries[501] = -114;
  *(_WORD *)&IDT__Entries[526] = (unsigned int)irq1 >> 16;
  *(_WORD *)&IDT__Entries[506] = 8;
  IDT__Entries[508] = 0;
  IDT__Entries[509] = -114;
  *(_WORD *)&IDT__Entries[514] = 8;
  IDT__Entries[516] = 0;
  IDT__Entries[517] = -114;
  *(_WORD *)&IDT__Entries[522] = 8;
  *(_WORD *)&IDT__Entries[528] = (unsigned int)irq2;
  IDT__Entries[524] = 0;
  *(_WORD *)&IDT__Entries[534] = (unsigned int)irq2 >> 16;
  *(_WORD *)&IDT__Entries[536] = (unsigned int)&irq3;
  IDT__Entries[525] = -114;
  *(_WORD *)&IDT__Entries[530] = 8;
  *(_WORD *)&IDT__Entries[542] = (unsigned int)&irq3 >> 16;
  *(_WORD *)&IDT__Entries[544] = (unsigned int)&irq4;
  IDT__Entries[532] = 0;
  IDT__Entries[533] = -114;
  *(_WORD *)&IDT__Entries[550] = (unsigned int)&irq4 >> 16;
  *(_WORD *)&IDT__Entries[552] = (unsigned int)irq5;
  *(_WORD *)&IDT__Entries[538] = 8;
  IDT__Entries[540] = 0;
  *(_WORD *)&IDT__Entries[558] = (unsigned int)irq5 >> 16;
  *(_WORD *)&IDT__Entries[560] = (unsigned int)irq6;
  IDT__Entries[541] = -114;
  *(_WORD *)&IDT__Entries[546] = 8;
  *(_WORD *)&IDT__Entries[566] = (unsigned int)irq6 >> 16;
  *(_WORD *)&IDT__Entries[568] = (unsigned int)&irq7;
  IDT__Entries[548] = 0;
  IDT__Entries[549] = -114;
  *(_WORD *)&IDT__Entries[574] = (unsigned int)&irq7 >> 16;
  *(_WORD *)&IDT__Entries[576] = (unsigned int)&irq8;
  *(_WORD *)&IDT__Entries[554] = 8;
  IDT__Entries[556] = 0;
  IDT__Entries[557] = -114;
  *(_WORD *)&IDT__Entries[562] = 8;
  IDT__Entries[564] = 0;
  IDT__Entries[565] = -114;
  *(_WORD *)&IDT__Entries[570] = 8;
  IDT__Entries[572] = 0;
  IDT__Entries[573] = -114;
  *(_WORD *)&IDT__Entries[582] = (unsigned int)&irq8 >> 16;
  *(_WORD *)&IDT__Entries[578] = 8;
  *(_WORD *)&IDT__Entries[584] = (unsigned int)irq9;
  IDT__Entries[580] = 0;
  IDT__Entries[581] = -114;
  *(_WORD *)&IDT__Entries[590] = (unsigned int)irq9 >> 16;
  *(_WORD *)&IDT__Entries[592] = (unsigned int)irq10;
  *(_WORD *)&IDT__Entries[586] = 8;
  IDT__Entries[588] = 0;
  *(_WORD *)&IDT__Entries[598] = (unsigned int)irq10 >> 16;
  *(_WORD *)&IDT__Entries[600] = (unsigned int)&irq11;
  IDT__Entries[589] = -114;
  *(_WORD *)&IDT__Entries[594] = 8;
  *(_WORD *)&IDT__Entries[606] = (unsigned int)&irq11 >> 16;
  *(_WORD *)&IDT__Entries[608] = (unsigned int)&irq12;
  IDT__Entries[596] = 0;
  IDT__Entries[597] = -114;
  *(_WORD *)&IDT__Entries[614] = (unsigned int)&irq12 >> 16;
  *(_WORD *)&IDT__Entries[616] = (unsigned int)irq13;
  *(_WORD *)&IDT__Entries[602] = 8;
  IDT__Entries[604] = 0;
  *(_WORD *)&IDT__Entries[622] = (unsigned int)irq13 >> 16;
  *(_WORD *)&IDT__Entries[624] = (unsigned int)irq14;
  IDT__Entries[605] = -114;
  *(_WORD *)&IDT__Entries[610] = 8;
  *(_WORD *)&IDT__Entries[630] = (unsigned int)irq14 >> 16;
  IDT__Entries[612] = 0;
  IDT__Entries[613] = -114;
  *(_WORD *)&IDT__Entries[618] = 8;
  IDT__Entries[620] = 0;
  IDT__Entries[621] = -114;
  *(_WORD *)&IDT__Entries[626] = 8;
  IDT__Entries[628] = 0;
  IDT__Entries[629] = -114;
  *(_WORD *)&IDT__Entries[632] = (unsigned int)&irq15;
  *(_WORD *)&IDT__Entries[634] = 8;
  IDT__Entries[636] = 0;
  *(_WORD *)&IDT__Entries[638] = (unsigned int)&irq15 >> 16;
  IDT__Entries[637] = -114;
  result = (int)IDT__Pointer;
  __asm { lidt    fword ptr [eax] }
  return result;
}
// C01000A0: using guessed type int isr0[3];
// C01000AF: using guessed type char isr1;
// C01000BE: using guessed type __int16 isr2;
// C01000DC: using guessed type int isr4[3];
// C01000EB: using guessed type char isr5;
// C01000FA: using guessed type __int16 isr6;
// C0100118: using guessed type int isr8[2];
// C0100122: using guessed type __int16 isr9;
// C010013B: using guessed type char isr11;
// C010014F: using guessed type char isr13;
// C0100163: using guessed type char isr15;
// C0100172: using guessed type __int16 isr16;
// C0100190: using guessed type int isr18[3];
// C010019F: using guessed type char isr19;
// C01001AE: using guessed type __int16 isr20;
// C01001CC: using guessed type int isr22[3];
// C01001DB: using guessed type char isr23;
// C01001EA: using guessed type __int16 isr24;
// C0100208: using guessed type int isr26[3];
// C0100217: using guessed type char isr27;
// C0100226: using guessed type __int16 isr28;
// C0100244: using guessed type int isr30[3];
// C0100253: using guessed type char isr31;
// C0100262: using guessed type __int16 irq0;
// C0100280: using guessed type int irq2[3];
// C010028F: using guessed type char irq3;
// C010029E: using guessed type __int16 irq4;
// C01002BC: using guessed type int irq6[3];
// C01002CB: using guessed type char irq7;
// C01002DA: using guessed type __int16 irq8;
// C01002F8: using guessed type int irq10[3];
// C0100307: using guessed type char irq11;
// C0100316: using guessed type __int16 irq12;
// C0100334: using guessed type int irq14[3];
// C0100343: using guessed type char irq15;

//----- (C01014C0) --------------------------------------------------------
int __cdecl IDT__SetGate(int a1, unsigned int a2, __int16 a3, char a4)
{
  int result; // eax@1

  result = a1;
  *(_WORD *)(8 * a1 - 1072643232) = a2;
  *(_BYTE *)(8 * a1 - 1072643228) = 0;
  *(_WORD *)(8 * a1 - 1072643226) = a2 >> 16;
  *(_WORD *)(8 * a1 - 1072643230) = a3;
  *(_BYTE *)(8 * a1 - 1072643227) = a4;
  return result;
}

//----- (C0101500) --------------------------------------------------------
int __cdecl IDT__InstallHandler(int a1, int a2)
{
  int result; // eax@1

  result = a1;
  *(_DWORD *)(4 * a1 - 1072643328) = a2;
  return result;
}

//----- (C0101510) --------------------------------------------------------
int __cdecl IDT__UninstallHandler(int a1)
{
  int result; // eax@1

  result = a1;
  *(_DWORD *)(4 * a1 - 1072643328) = 0;
  return result;
}

//----- (C0101520) --------------------------------------------------------
int __cdecl IDT__Flush()
{
  int result; // eax@1

  result = (int)IDT__Pointer;
  __asm { lidt    fword ptr [eax] }
  return result;
}

//----- (C0101530) --------------------------------------------------------
int __cdecl IDT__INT_Handler(int a1)
{
  int v1; // eax@3
  unsigned __int8 *v2; // esi@3
  int v3; // ST1C_4@3
  int v4; // eax@5
  int v5; // esi@5
  int v6; // eax@5
  int v7; // eax@5
  int v8; // eax@5
  int v10; // eax@5
  int v11; // eax@5
  int v12; // eax@5
  int v13; // ebx@5
  int v14; // eax@5
  int v15; // eax@5
  int v16; // eax@7
  int v18; // ebx@7
  int v19; // eax@7
  int v20; // eax@7

  *(_DWORD *)&IDT__Entries[224] = a1;
  if ( *(_DWORD *)(a1 + 48) <= 0x1Fu )
  {
    Globals__CLI();
    while ( !Log__Empty() )
    {
      v1 = Graphics__GetConsole();
      Console__WriteSubsystem(v1, (unsigned __int8 *)&aNotLinked[13], (unsigned __int8 *)"Crash Log", 3);
      v2 = *(unsigned __int8 **)(Log__Read() + 4);
      v3 = Graphics__GetConsole();
      Console__Write(v3, v2);
      Console__Write(v3, 0xAu);
    }
    v4 = Graphics__GetConsole();
    Console__WriteSubsystem(v4, (unsigned __int8 *)"Error number:", (unsigned __int8 *)"ISR", 3);
    v5 = *(_DWORD *)(a1 + 48);
    v6 = Graphics__GetConsole();
    Console__WriteNumber(v6, v5);
    v7 = Graphics__GetConsole();
    Console__WriteLine(v7);
    v8 = Graphics__GetConsole();
    Console__WriteSubsystem(v8, (unsigned __int8 *)"CR2:", (unsigned __int8 *)"ISR", 3);
    __asm { mov     esi, cr2 }
    v10 = Graphics__GetConsole();
    Console__WriteNumber(v10, _ESI);
    v11 = Graphics__GetConsole();
    Console__WriteLine(v11);
    v12 = Graphics__GetConsole();
    Console__WriteSubsystem(v12, (unsigned __int8 *)"EIP:", (unsigned __int8 *)"ISR", 3);
    v13 = *(_DWORD *)(a1 + 56);
    v14 = Graphics__GetConsole();
    Console__WriteNumber(v14, v13);
    v15 = Graphics__GetConsole();
    Console__WriteLine(v15);
    Graphics__RefreshConsole();
    Globals__HLT();
  }
  v16 = Graphics__GetConsole();
  Console__WriteSubsystem(v16, (unsigned __int8 *)"Interrupt recieved:", (unsigned __int8 *)"ISR", 1);
  v18 = *(_DWORD *)(a1 + 48);
  v19 = Graphics__GetConsole();
  Console__WriteNumber(v19, v18);
  v20 = Graphics__GetConsole();
  return Console__WriteLine(v20);
}
// C01018C0: using guessed type int Globals__HLT(void);
// C0101AE0: using guessed type _DWORD __cdecl Console__WriteLine(_DWORD);
// C0101D10: using guessed type _DWORD __cdecl Console__WriteNumber(_DWORD, _DWORD);

//----- (C0101700) --------------------------------------------------------
int __cdecl IDT__IRQ_Handler(int a1)
{
  unsigned int v1; // eax@1
  void (*v2)(void); // edx@1

  *(_DWORD *)&IDT__Entries[224] = a1;
  v1 = *(_DWORD *)(a1 + 48);
  v2 = *(void (**)(void))(4 * v1 - 1072643456);
  if ( v2 )
  {
    v2();
    v1 = *(_DWORD *)(a1 + 48);
  }
  if ( v1 > 0x27 )
    Globals__Outb(160, 32);
  return Globals__Outb(32, 32);
}

//----- (C0101760) --------------------------------------------------------
int __cdecl IDT__GetRegisters()
{
  return *(_DWORD *)&IDT__Entries[224];
}

//----- (C0101770) --------------------------------------------------------
int __cdecl Memory__Memory_Copy(int a1, int a2, int a3)
{
  int result; // eax@1
  int v4; // edx@1

  v4 = a3;
  for ( result = a1; v4; v4 -= 2 )
    *(_BYTE *)(a1 + v4) = *(_BYTE *)(a2 + v4);
  return result;
}

//----- (C01017A0) --------------------------------------------------------
int __cdecl Memory__Memory_Set(int a1, int a2, int a3)
{
  int result; // eax@1
  int v4; // edx@1

  v4 = a3;
  for ( result = a1; v4; --v4 )
    *(_DWORD *)(a1 + 4 * v4) = a2;
  return result;
}

//----- (C01017C0) --------------------------------------------------------
int __cdecl Memory__Memory_Set(int a1, __int16 a2, int a3)
{
  int result; // eax@1
  int v4; // edx@1

  v4 = a3;
  for ( result = a1; v4; --v4 )
    *(_WORD *)(a1 + 2 * v4) = a2;
  return result;
}

//----- (C01017E0) --------------------------------------------------------
int __cdecl Memory__Memory_Set(int a1, char a2, int a3)
{
  int result; // eax@1
  int v4; // edx@1

  v4 = a3;
  for ( result = a1; v4; --v4 )
    *(_BYTE *)(a1 + v4) = a2;
  return result;
}

//----- (C0101800) --------------------------------------------------------
int __cdecl Memory__Memory_Clear(int a1, int a2)
{
  int result; // eax@1
  int v3; // edx@1

  v3 = a2;
  for ( result = a1; v3; --v3 )
    *(_BYTE *)(a1 + v3) = 0;
  return result;
}

//----- (C0101820) --------------------------------------------------------
int __cdecl Memory__StaticMalloc(int a1)
{
  int result; // eax@1

  result = *(_DWORD *)&Keyboard__Keyboard_US[228];
  *(_DWORD *)&Keyboard__Keyboard_US[228] += a1;
  return result;
}

//----- (C0101840) --------------------------------------------------------
int __cdecl Memory__StaticMalloc(int a1, char a2, int a3)
{
  int v3; // eax@1
  int v4; // edx@2
  int result; // eax@4

  v3 = *(_DWORD *)&Keyboard__Keyboard_US[228];
  if ( a2 )
  {
    v4 = *(_DWORD *)&Keyboard__Keyboard_US[228] & 0xFFFFF000;
    if ( *(_DWORD *)&Keyboard__Keyboard_US[228] & 0xFFFFF000 )
    {
      v3 = v4 + 4096;
      *(_DWORD *)&Keyboard__Keyboard_US[228] = v4 + 4096;
    }
  }
  *(_DWORD *)a3 = v3;
  result = *(_DWORD *)&Keyboard__Keyboard_US[228];
  *(_DWORD *)&Keyboard__Keyboard_US[228] += a1;
  return result;
}

//----- (C0101880) --------------------------------------------------------
char __cdecl Globals__Inb(__int16 a1)
{
  char result; // al@1

  _DX = a1;
  __asm { in      al, dx }
  return result;
}

//----- (C0101890) --------------------------------------------------------
int __cdecl Globals__Outb(__int16 a1, char a2)
{
  int result; // eax@1

  LOBYTE(result) = a2;
  _DX = a1;
  __asm { out     dx, al }
  return result;
}

//----- (C01018A0) --------------------------------------------------------
void __cdecl Globals__CLI()
{
  ;
}

//----- (C01018B0) --------------------------------------------------------
void __cdecl Globals__STI()
{
  ;
}

//----- (C01018D0) --------------------------------------------------------
int __cdecl Console__Initialise_NoGraphics(int a1)
{
  int v2; // eax@1
  int v3; // edx@1

  *(_DWORD *)(a1 + 4) = 80;
  *(_DWORD *)(a1 + 8) = 25;
  *(_DWORD *)(a1 + 12) = 0;
  *(_DWORD *)(a1 + 16) = 0;
  *(_BYTE *)(a1 + 21) = 0;
  *(_BYTE *)(a1 + 20) = 15;
  v2 = operator new__(4000);
  v3 = *(_DWORD *)(a1 + 8) * *(_DWORD *)(a1 + 4);
  *(_DWORD *)a1 = v2;
  return Memory__Memory_Clear(v2, 2 * v3);
}
// C01018D0: using guessed type _DWORD __cdecl Console__Initialise_NoGraphics(_DWORD);

//----- (C0101930) --------------------------------------------------------
int __cdecl Console__SetColor(int a1, char a2)
{
  int result; // eax@1

  result = a1;
  *(_BYTE *)(a1 + 20) = a2;
  return result;
}

//----- (C0101940) --------------------------------------------------------
int __cdecl Console__Scroll(int a1)
{
  int result; // eax@1
  unsigned int v2; // edx@1
  int v3; // esi@2
  int v4; // ecx@2

  v2 = *(_DWORD *)(a1 + 16);
  result = *(_DWORD *)(a1 + 8);
  if ( v2 >= result )
  {
    v3 = 2 * *(_DWORD *)(a1 + 4);
    v4 = *(_DWORD *)a1;
    *(_BYTE *)(a1 + 21) = 1;
    Memory__Memory_Copy(v4, v4 + v3 * (v2 + 1 - result), v3 * (result - (v2 + 1 - result)));
    Memory__Memory_Clear(*(_DWORD *)a1 + *(_DWORD *)(a1 + 4) * (2 * *(_DWORD *)(a1 + 8) - 2), 2 * *(_DWORD *)(a1 + 4));
    result = *(_DWORD *)(a1 + 8) - 1;
    *(_DWORD *)(a1 + 16) = result;
  }
  return result;
}

//----- (C01019B0) --------------------------------------------------------
int __usercall Console__Write<eax>(int a1<eax>, unsigned __int8 a2<dl>)
{
  int v2; // ecx@7
  int v3; // edx@8
  int v4; // ecx@8
  int v5; // ebx@8
  int v6; // edi@11
  int v8; // ebx@16
  int v9; // ecx@16
  int v10; // esi@16
  int v11; // edi@16

  if ( a2 == 127 || a2 == 8 )
  {
    v3 = *(_DWORD *)(a1 + 16) * *(_DWORD *)(a1 + 4);
    v4 = *(_DWORD *)(a1 + 12);
    v5 = *(_DWORD *)a1;
    *(_BYTE *)(a1 + 21) = 1;
    *(_WORD *)(v5 + 2 * (v3 + v4)) = 32;
    if ( !v4 )
      return Console__Scroll(a1);
    v2 = v4 - 1;
    *(_DWORD *)(a1 + 12) = v2;
    *(_WORD *)(v5 + 2 * (v2 + v3)) = 32;
LABEL_10:
    if ( (unsigned int)v2 > 0x4F )
    {
      v6 = *(_DWORD *)(a1 + 16);
      *(_DWORD *)(a1 + 12) = 0;
      *(_DWORD *)(a1 + 16) = v6 + 1;
    }
    return Console__Scroll(a1);
  }
  if ( a2 != 13 )
  {
    if ( a2 != 10 )
    {
      if ( a2 == 9 )
      {
        v2 = (*(_DWORD *)(a1 + 12) + 8) & 0xFFFFFFF8;
        *(_DWORD *)(a1 + 12) = v2;
      }
      else
      {
        if ( a2 > 0x1Fu )
        {
          v8 = *(_DWORD *)(a1 + 16) * *(_DWORD *)(a1 + 4);
          v9 = *(_DWORD *)(a1 + 12);
          v10 = *(_DWORD *)a1;
          *(_BYTE *)(a1 + 21) = 1;
          v11 = v8 + v9;
          v2 = v9 + 1;
          *(_WORD *)(v10 + 2 * v11) = (*(_BYTE *)(a1 + 20) << 8) | a2;
          *(_DWORD *)(a1 + 12) = v2;
        }
        else
        {
          v2 = *(_DWORD *)(a1 + 12);
        }
      }
      goto LABEL_10;
    }
    ++*(_DWORD *)(a1 + 16);
  }
  *(_DWORD *)(a1 + 12) = 0;
  return Console__Scroll(a1);
}

//----- (C0101AB0) --------------------------------------------------------
int __cdecl Console__Write(int a3, unsigned __int8 a4)
{
  int result; // eax@1

  result = a3;
  if ( a4 )
    result = Console__Write(a3, a4);
  return result;
}

//----- (C0101AE0) --------------------------------------------------------
int __cdecl Console__WriteLine(int a3)
{
  return Console__Write(a3, 0xAu);
}
// C0101AE0: using guessed type _DWORD __cdecl Console__WriteLine(_DWORD);

//----- (C0101AF0) --------------------------------------------------------
int __cdecl Console__Write(int a1, unsigned __int8 *a2)
{
  unsigned __int8 i; // dl@1
  unsigned __int8 *v3; // ebx@1
  int result; // eax@2

  v3 = a2;
  for ( i = *a2; *v3; i = *v3 )
  {
    ++v3;
    result = Console__Write(a1, i);
  }
  return result;
}

//----- (C0101B30) --------------------------------------------------------
char __cdecl Console__WriteSubsystem(int a1, unsigned __int8 *a2, unsigned __int8 *a3, int a4)
{
  unsigned __int8 v4; // dl@1
  unsigned __int8 *v5; // ebx@1
  unsigned __int8 *v6; // esi@1
  char v7; // al@1
  unsigned __int8 v8; // dl@3
  char result; // al@6
  char v10; // [sp+Fh] [bp-1Dh]@1

  v6 = a3;
  v5 = a2;
  v7 = *(_BYTE *)(a1 + 20);
  *(_BYTE *)(a1 + 20) = 15;
  v10 = v7;
  Console__Write(a1, 0x5Bu);
  *(_BYTE *)(a1 + 20) = (unsigned int)(a4 - 1) < 3 ? 4 : 2;
  v4 = *a3;
  if ( *a3 )
  {
    do
    {
      ++v6;
      Console__Write(a1, v4);
      v4 = *v6;
    }
    while ( *v6 );
  }
  *(_BYTE *)(a1 + 20) = 15;
  v8 = 93;
  while ( 1 )
  {
    Console__Write(a1, v8);
    v8 = *v5;
    if ( !*v5 )
      break;
    ++v5;
  }
  result = v10;
  *(_BYTE *)(a1 + 20) = v10;
  return result;
}

//----- (C0101BD0) --------------------------------------------------------
unsigned int __cdecl Console__WriteMiddle(int a1, int a2)
{
  unsigned int result; // eax@1
  unsigned __int8 i; // dl@1
  int v4; // ebx@1

  v4 = a2;
  result = (unsigned int)String__StringLenght(a2) >> 1;
  *(_DWORD *)(a1 + 12) = 40 - result;
  for ( i = *(_BYTE *)a2; *(_BYTE *)v4; i = *(_BYTE *)v4 )
  {
    ++v4;
    result = Console__Write(a1, i);
  }
  return result;
}

//----- (C0101C20) --------------------------------------------------------
int __cdecl Console__WriteLine(int a3, unsigned __int8 *a4)
{
  unsigned __int8 i; // dl@1
  unsigned __int8 *v5; // ebx@1

  v5 = a4;
  for ( i = *a4; *v5; i = *v5 )
  {
    ++v5;
    Console__Write(a3, i);
  }
  return Console__Write(a3, 0xAu);
}

//----- (C0101C70) --------------------------------------------------------
char __cdecl Console__WriteLineSubsystem(int a1, unsigned __int8 *a2, unsigned __int8 *a3, int a4)
{
  unsigned __int8 *v4; // ebx@1
  char v5; // bp@1
  unsigned __int8 *v6; // esi@1
  unsigned __int8 v7; // dl@3
  unsigned __int8 v8; // dl@5
  char result; // al@8
  char v10; // [sp+Fh] [bp-1Dh]@1

  v5 = 2;
  v4 = a2;
  v6 = a3;
  v10 = *(_BYTE *)(a1 + 20);
  if ( (unsigned int)(a4 - 2) <= 1 )
    v5 = *(_BYTE *)(4 * (a4 - 2) - 1072660088);
  *(_BYTE *)(a1 + 20) = 15;
  Console__Write(a1, 0x5Bu);
  *(_BYTE *)(a1 + 20) = v5;
  v7 = *a3;
  if ( *a3 )
  {
    do
    {
      ++v6;
      Console__Write(a1, v7);
      v7 = *v6;
    }
    while ( *v6 );
  }
  *(_BYTE *)(a1 + 20) = 15;
  v8 = 93;
  while ( 1 )
  {
    Console__Write(a1, v8);
    v8 = *v4;
    if ( !*v4 )
      break;
    ++v4;
  }
  Console__Write(a1, 0xAu);
  result = v10;
  *(_BYTE *)(a1 + 20) = v10;
  return result;
}

//----- (C0101D10) --------------------------------------------------------
int __cdecl Console__WriteNumber(int a1, unsigned int a2)
{
  unsigned int v2; // eax@2
  unsigned int v3; // eax@3
  unsigned int v4; // eax@4
  unsigned int v5; // eax@5
  unsigned int v6; // eax@6
  unsigned int v7; // eax@7
  unsigned __int8 v8; // dl@10
  unsigned __int8 *v9; // ebx@10
  int result; // eax@12
  unsigned int i; // ebx@12
  char *v12; // eax@13
  unsigned __int8 v13; // dl@17
  char v14[4]; // ebx@17
  char v15; // [sp+17h] [bp-15h]@2
  char v16; // [sp+18h] [bp-14h]@3
  char v17; // [sp+19h] [bp-13h]@4
  char v18; // [sp+1Ah] [bp-12h]@5
  char v19; // [sp+1Bh] [bp-11h]@6
  char v20; // [sp+1Ch] [bp-10h]@7
  char v21; // [sp+1Dh] [bp-Fh]@8
  char v22; // [sp+1Eh] [bp-Eh]@9
  char v23[12]; // [sp+20h] [bp-Ch]@13

  if ( a2 )
  {
    Memory__Memory_Clear((int)&v15, 9);
    v15 = byte_C0108176[a2 & 0xF];
    v2 = a2 >> 4;
    if ( a2 >> 4 )
    {
      v16 = byte_C0108176[v2 & 0xF];
      v3 = a2 >> 8;
      if ( a2 >> 8 )
      {
        v17 = byte_C0108176[v3 & 0xF];
        v4 = a2 >> 12;
        if ( a2 >> 12 )
        {
          v18 = byte_C0108176[v4 & 0xF];
          v5 = a2 >> 16;
          if ( a2 >> 16 )
          {
            v19 = byte_C0108176[v5 & 0xF];
            v6 = a2 >> 20;
            if ( a2 >> 20 )
            {
              v20 = byte_C0108176[v6 & 0xF];
              v7 = a2 >> 24;
              if ( a2 >> 24 )
              {
                v21 = byte_C0108176[v7 & 0xF];
                if ( a2 >> 28 )
                  v22 = byte_C0108176[a2 >> 28];
              }
            }
          }
        }
      }
    }
    v8 = 48;
    v9 = (unsigned __int8 *)"0x";
    do
    {
      ++v9;
      Console__Write(a1, v8);
      v8 = *v9;
    }
    while ( *v9 );
    result = String__StringLenght((int)&v15);
    for ( i = 0; i < result; ++i )
    {
      v12 = &v23[String__StringLenght((int)&v15)];
      if ( v12[~i - 9] )
        Console__Write(a1, v12[~i - 9]);
      result = String__StringLenght((int)&v15);
    }
  }
  else
  {
    v13 = 48;
    *(_DWORD *)v14 = "0x0";
    do
    {
      ++*(_DWORD *)v14;
      result = Console__Write(a1, v13);
      v13 = **(_BYTE **)v14;
    }
    while ( **(_BYTE **)v14 );
  }
  return result;
}
// C0101D10: using guessed type _DWORD __cdecl Console__WriteNumber(_DWORD, _DWORD);
// C0101D10: using guessed type char var_C[12];

//----- (C0101E80) --------------------------------------------------------
int __cdecl Console__Clear(int a1)
{
  int result; // eax@1
  int v2; // eax@1

  v2 = (unsigned int)(*(_DWORD *)(a1 + 4) * *(_DWORD *)(a1 + 8)) >> 1;
  *(_BYTE *)(a1 + 21) = 1;
  result = Memory__Memory_Clear(*(_DWORD *)a1, v2);
  *(_DWORD *)(a1 + 16) = 0;
  *(_DWORD *)(a1 + 12) = 0;
  return result;
}

//----- (C0101EC0) --------------------------------------------------------
int __cdecl Console__operator__(int a1, int a2)
{
  *(_BYTE *)a2 = Keyboard__ReadKey();
  return a1;
}

//----- (C0101EE0) --------------------------------------------------------
int __cdecl Console__operator__(int a1, int *a2)
{
  Keyboard__ReadLine(*a2);
  return a1;
}

//----- (C0101F00) --------------------------------------------------------
unsigned int __cdecl Log__Install()
{
  unsigned int result; // eax@1
  int v1; // edx@3
  signed int v2; // ecx@3
  int v3; // ebx@3
  signed __int64 v4; // qax@3
  signed __int64 v5; // qtt@3

  Memory__Memory_Clear((int)Log__Entries, 200);
  Heap__End = 0;
  Heap__Start = 0;
  result = String__StringLenght((int)"Log created");
  if ( result <= 0x50 )
  {
    v3 = 8 * Heap__End;
    *(_QWORD *)&Heap__Top += 4294967296LL;
    *(_DWORD *)&Log__Entries[v3] = String__StringLenght((int)"Log created");
    v2 = *(_DWORD *)&Keyboard__Keyboard_US[232];
    v4 = *(_QWORD *)&Heap__Top >> 32;
    *(_DWORD *)(v3 - 1072641148) = "Log created";
    v5 = v4;
    result = v4 / v2;
    v1 = v5 % v2;
    Heap__End = v1;
    if ( v1 == Heap__Start )
    {
      result = (v1 + 1) / v2;
      Heap__Start = (v1 + 1) % v2;
    }
  }
  return result;
}
// C010CC5C: using guessed type int Heap__Top;
// C010CC60: using guessed type int Heap__End;
// C010CC64: using guessed type int Heap__Start;

//----- (C0101FC0) --------------------------------------------------------
unsigned int __cdecl Log__Write(int a1)
{
  unsigned int result; // eax@1
  int v2; // edx@3
  signed int v3; // ecx@3
  int v4; // esi@3
  signed __int64 v5; // qax@3
  signed __int64 v6; // qtt@3

  result = String__StringLenght(a1);
  if ( result <= 0x50 )
  {
    v4 = 8 * Heap__End;
    *(_QWORD *)&Heap__Top += 4294967296LL;
    *(_DWORD *)&Log__Entries[v4] = String__StringLenght(a1);
    v3 = *(_DWORD *)&Keyboard__Keyboard_US[232];
    v5 = *(_QWORD *)&Heap__Top >> 32;
    *(_DWORD *)(v4 - 1072641148) = a1;
    v6 = v5;
    result = v5 / v3;
    v2 = v6 % v3;
    Heap__End = v2;
    if ( v2 == Heap__Start )
    {
      result = (v2 + 1) / v3;
      Heap__Start = (v2 + 1) % v3;
    }
  }
  return result;
}
// C0101FC0: using guessed type _DWORD __cdecl Log__Write(_DWORD);
// C010CC5C: using guessed type int Heap__Top;
// C010CC60: using guessed type int Heap__End;
// C010CC64: using guessed type int Heap__Start;

//----- (C0102040) --------------------------------------------------------
int __cdecl Log__Read()
{
  int v1; // ecx@1

  v1 = Heap__Start;
  Heap__Start = (Heap__Start + 1) % *(_DWORD *)&Keyboard__Keyboard_US[232];
  return 8 * v1 - 1072641152;
}
// C010CC64: using guessed type int Heap__Start;

//----- (C0102070) --------------------------------------------------------
char __cdecl Log__Empty()
{
  return Heap__Start == Heap__End;
}
// C010CC60: using guessed type int Heap__End;
// C010CC64: using guessed type int Heap__Start;

//----- (C0102080) --------------------------------------------------------
void __cdecl PIT__Handler()
{
  ++vc010cd48;
  if ( vc010cd48 != 17 * vc010cd48 / 0x11u )
  {
    Tasking__Switch();
    Graphics__RefreshConsole();
  }
}

//----- (C01020C0) --------------------------------------------------------
int __cdecl PIT__Install()
{
  vc010cd48 = 0;
  IDT__InstallHandler(0, (int)PIT__Handler);
  Globals__Outb(67, 54);
  Globals__Outb(64, -87);
  return Globals__Outb(64, 4);
}

//----- (C0102130) --------------------------------------------------------
int __cdecl PIT__Phase(unsigned int a1)
{
  unsigned int v2; // ebx@1

  v2 = 0x1234DC / a1;
  Globals__Outb(67, 54);
  Globals__Outb(64, 0x1234DC / a1);
  return Globals__Outb(64, SBYTE1(v2));
}

//----- (C0102190) --------------------------------------------------------
int __cdecl PIT__Sleep(int a1)
{
  int result; // eax@1

  result = vc010cd48;
  if ( (unsigned int)(a1 + vc010cd48) > vc010cd48 )
    Globals__HLT();
  return result;
}
// C01018C0: using guessed type int Globals__HLT(void);
// C0102190: using guessed type _DWORD __cdecl PIT__Sleep(_DWORD);

//----- (C01021D0) --------------------------------------------------------
int __cdecl PIT__Clocks()
{
  return vc010cd48;
}

//----- (C01021E0) --------------------------------------------------------
int __cdecl String__StringLenght(int a1)
{
  int result; // eax@1

  result = 0;
  if ( *(_BYTE *)a1 )
  {
    do
      ++result;
    while ( *(_BYTE *)(a1 + result) );
  }
  return result;
}

//----- (C0102200) --------------------------------------------------------
char __cdecl String__StringCompare(int a1, int a2)
{
  int v2; // ebx@1
  int v3; // ecx@3
  char result; // al@5
  unsigned int i; // ecx@9
  unsigned int v6; // eax@10

  v2 = 0;
  if ( *(_BYTE *)a1 )
  {
    do
      ++v2;
    while ( *(_BYTE *)(a1 + v2) );
  }
  v3 = 0;
  if ( *(_BYTE *)a2 )
  {
    do
      ++v3;
    while ( *(_BYTE *)(a2 + v3) );
  }
  result = 0;
  if ( v2 == v3 )
  {
    if ( *(_BYTE *)a1 )
    {
      for ( i = 0; ; ++i )
      {
        v6 = 0;
        do
          ++v6;
        while ( *(_BYTE *)(a1 + v6) );
        if ( i >= v6 )
          break;
        if ( *(_BYTE *)(a1 + i) != *(_BYTE *)(a2 + i) )
          return 0;
      }
    }
    result = 1;
  }
  return result;
}

//----- (C0102280) --------------------------------------------------------
int __cdecl String__FromString(int a1)
{
  int result; // eax@1
  unsigned int v2; // edx@2
  int v3; // ecx@6
  int v4; // ebx@6
  int v5; // eax@7
  char v6; // bl@7
  int v7; // edi@7

  result = 0;
  if ( *(_BYTE *)a1 )
  {
    v2 = 0;
    do
      ++v2;
    while ( *(_BYTE *)(a1 + v2) );
    result = 0;
    if ( v2 <= 0xA )
    {
      if ( v2 )
      {
        v4 = 0;
        v3 = 0;
        do
        {
          v6 = *(_BYTE *)(a1 + v4);
          v5 = 10 * result;
          v7 = 0;
          if ( (unsigned __int8)(v6 - 48) <= 9u )
            v7 = v6 - 48;
          ++v3;
          result = v7 + v5;
          v4 = v3;
        }
        while ( v3 != v2 );
      }
    }
  }
  return result;
}

//----- (C01022F0) --------------------------------------------------------
char __cdecl Heap__MemSortFunction(int a1, int a2)
{
  return *(_DWORD *)(a1 + 4) - *(_DWORD *)a1 < (unsigned int)(*(_DWORD *)(a2 + 4) - *(_DWORD *)a2);
}

//----- (C0102310) --------------------------------------------------------
int __cdecl Heap__Grow(int a1)
{
  int result; // eax@1
  int v2; // edx@2
  int v3; // edi@2
  int v4; // ebx@3
  int v5; // eax@5
  int v6; // eax@5

  result = vc010cd60;
  if ( a1 )
  {
    v2 = vc010cd60;
    v3 = a1 << 12;
    result = 0;
    if ( (unsigned int)((a1 << 12) + vc010cd60) <= vc010cd5c )
    {
      v4 = 0;
      while ( 1 )
      {
        v5 = v4++ << 12;
        v6 = Memory__Virtual__GetPage(v5 + v2, 1, vc010cd6c);
        Memory__Virtual__AllocateFrame(v6, 1, 1);
        if ( v4 == a1 )
          break;
        v2 = vc010cd60;
      }
      result = v3 + vc010cd60;
      vc010cd60 += v3;
    }
  }
  return result;
}
// C01038A0: using guessed type _DWORD __cdecl Memory__Virtual__GetPage(_DWORD, char, _DWORD);

//----- (C01023A0) --------------------------------------------------------
int __cdecl Heap__Shrink(int a1)
{
  int result; // eax@1
  int v2; // edx@2
  int v3; // edi@2
  int v4; // ebx@3
  int v5; // eax@5
  int v6; // eax@5

  result = vc010cd60;
  if ( a1 )
  {
    v2 = vc010cd60;
    v3 = a1 << 12;
    result = 0;
    if ( (unsigned int)(vc010cd60 - (a1 << 12)) >= vc010cd58 )
    {
      v4 = 0;
      while ( 1 )
      {
        v5 = v4++ << 12;
        v6 = Memory__Virtual__GetPage(v2 - v5, 1, vc010cd6c);
        Memory__Virtual__FreeFrame(v6);
        if ( v4 == a1 )
          break;
        v2 = vc010cd60;
      }
      result = vc010cd60 - v3;
      vc010cd60 -= v3;
    }
  }
  return result;
}
// C01038A0: using guessed type _DWORD __cdecl Memory__Virtual__GetPage(_DWORD, char, _DWORD);

//----- (C0102420) --------------------------------------------------------
void __cdecl Heap__Free(int a1)
{
  int v1; // eax@1
  int v2; // ecx@1
  int v3; // ebx@1
  int v4; // esi@1
  int v5; // edx@5
  int v6; // edx@6
  int v7; // esi@9
  unsigned int v8; // ebx@10
  signed int v9; // edi@10
  int v10; // ecx@11
  int v11; // ebp@11
  int v12; // edx@13
  unsigned int v13; // eax@18
  int v14; // eax@21
  unsigned int v15; // eax@22
  unsigned int v16; // edx@22
  int v17; // esi@22
  int v18; // ebx@23
  int v19; // eax@24
  int (__cdecl *v20)(int, int); // ecx@24
  unsigned int v21; // ebx@25
  int v22; // edi@25
  int v23; // ecx@26
  int v24; // ebp@26
  int v25; // edx@28
  int v26; // eax@34
  unsigned int v27; // ecx@38
  int v28; // ebx@39
  int v29; // edx@41
  int v30; // esi@48
  unsigned int v31; // ebx@49
  signed int v32; // edi@49
  int v33; // ecx@50
  int v34; // ebp@50
  int v35; // edx@52
  unsigned int v36; // eax@57
  unsigned int v37; // eax@59
  int v38; // esi@59
  int v39; // ebx@60
  int v40; // eax@61
  int (__cdecl *v41)(int, int); // ebx@61
  unsigned int v42; // ebx@62
  signed int v43; // edi@62
  int v44; // ecx@63
  int v45; // ebp@63
  int v46; // edx@65
  unsigned int v47; // eax@70
  int v48; // eax@75
  int v49; // edx@75
  unsigned int v50; // eax@77
  int v51; // esi@77
  int v52; // ebx@78
  int v53; // eax@79
  unsigned int v54; // ebx@80
  signed int v55; // edi@80
  int v56; // ecx@81
  int v57; // ebp@81
  int v58; // edx@83
  unsigned int v59; // eax@88
  unsigned int v60; // eax@90
  int v61; // esi@90
  int v62; // ebx@91
  int v63; // eax@92
  unsigned int v64; // ebx@93
  signed int v65; // edi@93
  int v66; // ecx@94
  int v67; // ebp@94
  int v68; // edx@96
  unsigned int v69; // eax@101
  unsigned int v70; // eax@103
  int v71; // esi@103
  int v72; // ebx@104
  int v73; // eax@105
  int (__cdecl *v74)(int, int); // edx@105
  unsigned int v75; // ebx@106
  signed int v76; // edi@106
  int v77; // ecx@107
  int v78; // ebp@107
  int v79; // edx@109
  unsigned int v80; // eax@114
  int v81; // eax@118
  int v82; // eax@118
  int v83; // eax@120
  int v84; // eax@120
  int v85; // eax@122
  int v86; // eax@122
  int v87; // eax@124
  int v88; // eax@124
  int v89; // [sp+14h] [bp-28h]@15
  int v90; // [sp+14h] [bp-28h]@30
  int v91; // [sp+14h] [bp-28h]@54
  int v92; // [sp+14h] [bp-28h]@67
  int v93; // [sp+14h] [bp-28h]@85
  int v94; // [sp+14h] [bp-28h]@98
  int v95; // [sp+14h] [bp-28h]@111
  int v96; // [sp+18h] [bp-24h]@10
  int v97; // [sp+18h] [bp-24h]@21
  int v98; // [sp+18h] [bp-24h]@49
  int v99; // [sp+1Ch] [bp-20h]@62
  int v100; // [sp+1Ch] [bp-20h]@80
  int v101; // [sp+1Ch] [bp-20h]@93
  int v102; // [sp+1Ch] [bp-20h]@106

  v3 = a1 - 4;
  v2 = *(_DWORD *)(a1 - 4) + 4;
  v1 = vc010cd50;
  v4 = v2 + a1 - 4;
  if ( !vc010cd50 )
  {
    if ( *(_DWORD *)(vc010cd54 + 8) )
      v1 = **(_DWORD **)(vc010cd54 + 4);
  }
  while ( *(_DWORD *)(v1 + 8) )
    v1 = *(_DWORD *)(v1 + 8);
  v5 = *(_DWORD *)v1;
  if ( *(_DWORD *)v1 == v4 )
  {
LABEL_9:
    *(_DWORD *)v1 = v5 - v2;
    Heap__Unlink(v1);
    v7 = vc010cd54;
    if ( *vc010cd54 )
    {
      v9 = 4;
      v96 = 0;
      v8 = 0;
      while ( 1 )
      {
        v13 = *(_DWORD *)(v7 + 8);
        if ( v8 >= v13 - 1 )
          break;
        v11 = 0;
        v10 = *(_DWORD *)(v7 + 4);
        if ( v8 < v13 )
          v11 = *(_DWORD *)(v10 + v96);
        ++v8;
        v12 = 0;
        if ( v8 < v13 )
          v12 = *(_DWORD *)(v10 + v9);
        v89 = v12;
        if ( !(unsigned __int8)(*(int (__cdecl **)(int, int))v7)(v11, v12) )
        {
          *(_DWORD *)(*(_DWORD *)(v7 + 4) + v96) = v89;
          *(_DWORD *)(*(_DWORD *)(v7 + 4) + v9) = v11;
        }
        v9 += 4;
        v96 += 4;
      }
    }
    return;
  }
  while ( 1 )
  {
    v6 = *(_DWORD *)(v1 + 4);
    if ( v3 == v6 )
    {
      *(_DWORD *)(v1 + 4) = v2 + v6;
      Heap__Unlink(v1);
      v30 = vc010cd54;
      if ( *vc010cd54 )
      {
        v32 = 4;
        v98 = 0;
        v31 = 0;
        while ( 1 )
        {
          v36 = *(_DWORD *)(v30 + 8);
          if ( v31 >= v36 - 1 )
            break;
          v34 = 0;
          v33 = *(_DWORD *)(v30 + 4);
          if ( v31 < v36 )
            v34 = *(_DWORD *)(v33 + v98);
          ++v31;
          v35 = 0;
          if ( v31 < v36 )
            v35 = *(_DWORD *)(v33 + v32);
          v91 = v35;
          if ( !(unsigned __int8)(*(int (__cdecl **)(int, int))v30)(v34, v35) )
          {
            *(_DWORD *)(*(_DWORD *)(v30 + 4) + v98) = v91;
            *(_DWORD *)(*(_DWORD *)(v30 + 4) + v32) = v34;
          }
          v32 += 4;
          v98 += 4;
        }
      }
      return;
    }
    v1 = *(_DWORD *)(v1 + 12);
    if ( !v1 )
      break;
    v5 = *(_DWORD *)v1;
    if ( *(_DWORD *)v1 == v4 )
      goto LABEL_9;
  }
  if ( vc010cd4c )
  {
    v14 = Heap__Malloc(16);
    v97 = v14;
  }
  else
  {
    v14 = Memory__StaticMalloc(16);
    v97 = v14;
  }
  *(_DWORD *)(v14 + 4) = v4;
  v17 = vc010cd54;
  *(_DWORD *)(v14 + 8) = 0;
  *(_DWORD *)(v14 + 12) = 0;
  *(_DWORD *)v14 = v3;
  v16 = *(_DWORD *)(v17 + 12);
  v15 = *(_DWORD *)(v17 + 8);
  if ( v15 >= v16 )
  {
    v49 = (v16 >> 1) + v16;
    *(_DWORD *)(v17 + 12) = v49;
    v18 = Heap__Malloc(4 * v49);
    Memory__Memory_Copy(v18, *(_DWORD *)(v17 + 4), 4 * *(_DWORD *)(v17 + 8));
    v48 = *(_DWORD *)(v17 + 4);
    *(_DWORD *)(v17 + 4) = v18;
    if ( *(_BYTE *)(v17 + 16) )
    {
      Heap__Free(v48);
      v18 = *(_DWORD *)(v17 + 4);
      v15 = *(_DWORD *)(v17 + 8);
    }
    else
    {
      *(_BYTE *)(v17 + 16) = 1;
      v15 = *(_DWORD *)(v17 + 8);
    }
  }
  else
  {
    v18 = *(_DWORD *)(v17 + 4);
  }
  *(_DWORD *)(v18 + 4 * v15) = v97;
  v19 = v15 + 1;
  v20 = *(int (__cdecl **)(int, int))v17;
  *(_DWORD *)(v17 + 8) = v19;
  if ( v20 )
  {
    v21 = 0;
    v22 = 0;
    while ( v21 < v19 - 1 )
    {
      v24 = 0;
      v23 = *(_DWORD *)(v17 + 4);
      if ( v21 < v19 )
        v24 = *(_DWORD *)(v23 + v22);
      ++v21;
      v25 = 0;
      if ( v21 < v19 )
        v25 = *(_DWORD *)(v23 + 4 * v21);
      v90 = v25;
      if ( !(unsigned __int8)(*(int (__cdecl **)(int, int))v17)(v24, v25) )
      {
        *(_DWORD *)(*(_DWORD *)(v17 + 4) + v22) = v90;
        *(_DWORD *)(*(_DWORD *)(v17 + 4) + 4 * v21) = v24;
      }
      v19 = *(_DWORD *)(v17 + 8);
      v22 += 4;
    }
  }
  v26 = vc010cd50;
  if ( !vc010cd50 )
  {
    if ( *(_DWORD *)(vc010cd54 + 8) )
      v26 = **(_DWORD **)(vc010cd54 + 4);
  }
  while ( *(_DWORD *)(v26 + 8) )
    v26 = *(_DWORD *)(v26 + 8);
  v27 = *(_DWORD *)(v97 + 4);
  if ( *(_DWORD *)v26 <= v27 )
    goto LABEL_45;
LABEL_39:
  v28 = *(_DWORD *)(v26 + 8);
  if ( !v28 )
  {
    v51 = vc010cd54;
    *(_DWORD *)(v97 + 8) = 0;
    *(_DWORD *)(v97 + 12) = v26;
    *(_DWORD *)(v26 + 8) = v97;
    v50 = *(_DWORD *)(v51 + 12);
    if ( *(_DWORD *)(v51 + 8) >= v50 )
    {
      v82 = (v50 >> 1) + v50;
      *(_DWORD *)(v51 + 12) = v82;
      v52 = Heap__Malloc(4 * v82);
      Memory__Memory_Copy(v52, *(_DWORD *)(v51 + 4), 4 * *(_DWORD *)(v51 + 8));
      v81 = *(_DWORD *)(v51 + 4);
      *(_DWORD *)(v51 + 4) = v52;
      if ( !*(_BYTE *)(v51 + 16) )
      {
        *(_BYTE *)(v51 + 16) = 1;
LABEL_79:
        v53 = *(_DWORD *)(v51 + 8);
        *(_DWORD *)(v52 + 4 * v53) = v97;
        *(_DWORD *)(v51 + 8) = v53 + 1;
        if ( *(_DWORD *)v51 )
        {
          v100 = 0;
          v54 = 0;
          v55 = 4;
          while ( 1 )
          {
            v59 = *(_DWORD *)(v51 + 8);
            if ( v54 >= v59 - 1 )
              break;
            v57 = 0;
            v56 = *(_DWORD *)(v51 + 4);
            if ( v54 < v59 )
              v57 = *(_DWORD *)(v56 + v100);
            ++v54;
            v58 = 0;
            if ( v54 < v59 )
              v58 = *(_DWORD *)(v56 + v55);
            v93 = v58;
            if ( !(unsigned __int8)(*(int (__cdecl **)(int, int))v51)(v57, v58) )
            {
              *(_DWORD *)(*(_DWORD *)(v51 + 4) + v100) = v93;
              *(_DWORD *)(*(_DWORD *)(v51 + 4) + v55) = v57;
            }
            v55 += 4;
            v100 += 4;
          }
        }
        goto LABEL_71;
      }
      Heap__Free(v81);
    }
    v52 = *(_DWORD *)(v51 + 4);
    goto LABEL_79;
  }
  if ( *(_DWORD *)(v28 + 4) < *(_DWORD *)v97 )
  {
    v61 = vc010cd54;
    *(_DWORD *)(v97 + 12) = v26;
    *(_DWORD *)(v97 + 8) = v28;
    *(_DWORD *)(v26 + 8) = v97;
    v60 = *(_DWORD *)(v61 + 12);
    *(_DWORD *)(v28 + 12) = v97;
    if ( *(_DWORD *)(v61 + 8) >= v60 )
    {
      v86 = (v60 >> 1) + v60;
      *(_DWORD *)(v61 + 12) = v86;
      v62 = Heap__Malloc(4 * v86);
      Memory__Memory_Copy(v62, *(_DWORD *)(v61 + 4), 4 * *(_DWORD *)(v61 + 8));
      v85 = *(_DWORD *)(v61 + 4);
      *(_DWORD *)(v61 + 4) = v62;
      if ( !*(_BYTE *)(v61 + 16) )
      {
        *(_BYTE *)(v61 + 16) = 1;
LABEL_92:
        v63 = *(_DWORD *)(v61 + 8);
        *(_DWORD *)(v62 + 4 * v63) = v97;
        *(_DWORD *)(v61 + 8) = v63 + 1;
        if ( *(_DWORD *)v61 )
        {
          v101 = 0;
          v64 = 0;
          v65 = 4;
          while ( 1 )
          {
            v69 = *(_DWORD *)(v61 + 8);
            if ( v64 >= v69 - 1 )
              break;
            v67 = 0;
            v66 = *(_DWORD *)(v61 + 4);
            if ( v64 < v69 )
              v67 = *(_DWORD *)(v66 + v101);
            ++v64;
            v68 = 0;
            if ( v64 < v69 )
              v68 = *(_DWORD *)(v66 + v65);
            v94 = v68;
            if ( !(unsigned __int8)(*(int (__cdecl **)(int, int))v61)(v67, v68) )
            {
              *(_DWORD *)(*(_DWORD *)(v61 + 4) + v101) = v94;
              *(_DWORD *)(*(_DWORD *)(v61 + 4) + v65) = v67;
            }
            v65 += 4;
            v101 += 4;
          }
        }
        goto LABEL_71;
      }
      Heap__Free(v85);
    }
    v62 = *(_DWORD *)(v61 + 4);
    goto LABEL_92;
  }
  v29 = *(_DWORD *)(v26 + 12);
  if ( *(_DWORD *)(v26 + 4) < *(_DWORD *)v97 )
  {
LABEL_42:
    if ( v29 )
    {
      if ( *(_DWORD *)v29 <= v27 )
        goto LABEL_44;
      v38 = vc010cd54;
      *(_DWORD *)(v97 + 8) = v26;
      *(_DWORD *)(v97 + 12) = v29;
      *(_DWORD *)(v26 + 12) = v97;
      v37 = *(_DWORD *)(v38 + 12);
      *(_DWORD *)(v29 + 8) = v97;
      if ( *(_DWORD *)(v38 + 8) >= v37 )
      {
        v84 = (v37 >> 1) + v37;
        *(_DWORD *)(v38 + 12) = v84;
        v39 = Heap__Malloc(4 * v84);
        Memory__Memory_Copy(v39, *(_DWORD *)(v38 + 4), 4 * *(_DWORD *)(v38 + 8));
        v83 = *(_DWORD *)(v38 + 4);
        *(_DWORD *)(v38 + 4) = v39;
        if ( *(_BYTE *)(v38 + 16) )
        {
          Heap__Free(v83);
          goto LABEL_60;
        }
        *(_BYTE *)(v38 + 16) = 1;
      }
      else
      {
LABEL_60:
        v39 = *(_DWORD *)(v38 + 4);
      }
      v40 = *(_DWORD *)(v38 + 8);
      *(_DWORD *)(v39 + 4 * v40) = v97;
      v41 = *(int (__cdecl **)(int, int))v38;
      *(_DWORD *)(v38 + 8) = v40 + 1;
      if ( v41 )
      {
        v99 = 0;
        v42 = 0;
        v43 = 4;
        while ( 1 )
        {
          v47 = *(_DWORD *)(v38 + 8);
          if ( v42 >= v47 - 1 )
            break;
          v45 = 0;
          v44 = *(_DWORD *)(v38 + 4);
          if ( v42 < v47 )
            v45 = *(_DWORD *)(v44 + v99);
          ++v42;
          v46 = 0;
          if ( v42 < v47 )
            v46 = *(_DWORD *)(v44 + v43);
          v92 = v46;
          if ( !(unsigned __int8)(*(int (__cdecl **)(int, int))v38)(v45, v46) )
          {
            *(_DWORD *)(*(_DWORD *)(v38 + 4) + v99) = v92;
            *(_DWORD *)(*(_DWORD *)(v38 + 4) + v43) = v45;
          }
          v43 += 4;
          v99 += 4;
        }
      }
LABEL_71:
      Heap__Unlink(v97);
      return;
    }
    v71 = vc010cd54;
    *(_DWORD *)(v97 + 8) = v26;
    *(_DWORD *)(v97 + 12) = 0;
    *(_DWORD *)(v26 + 12) = v97;
    v70 = *(_DWORD *)(v71 + 12);
    if ( *(_DWORD *)(v71 + 8) >= v70 )
    {
      v88 = (v70 >> 1) + v70;
      *(_DWORD *)(v71 + 12) = v88;
      v72 = Heap__Malloc(4 * v88);
      Memory__Memory_Copy(v72, *(_DWORD *)(v71 + 4), 4 * *(_DWORD *)(v71 + 8));
      v87 = *(_DWORD *)(v71 + 4);
      *(_DWORD *)(v71 + 4) = v72;
      if ( *(_BYTE *)(v71 + 16) )
      {
        Heap__Free(v87);
        goto LABEL_104;
      }
      *(_BYTE *)(v71 + 16) = 1;
    }
    else
    {
LABEL_104:
      v72 = *(_DWORD *)(v71 + 4);
    }
    v73 = *(_DWORD *)(v71 + 8);
    *(_DWORD *)(v72 + 4 * v73) = v97;
    v74 = *(int (__cdecl **)(int, int))v71;
    *(_DWORD *)(v71 + 8) = v73 + 1;
    if ( v74 )
    {
      v102 = 0;
      v75 = 0;
      v76 = 4;
      while ( 1 )
      {
        v80 = *(_DWORD *)(v71 + 8);
        if ( v75 >= v80 - 1 )
          break;
        v78 = 0;
        v77 = *(_DWORD *)(v71 + 4);
        if ( v75 < v80 )
          v78 = *(_DWORD *)(v77 + v102);
        ++v75;
        v79 = 0;
        if ( v75 < v80 )
          v79 = *(_DWORD *)(v77 + v76);
        v95 = v79;
        if ( !(unsigned __int8)(*(int (__cdecl **)(int, int))v71)(v78, v79) )
        {
          *(_DWORD *)(*(_DWORD *)(v71 + 4) + v102) = v95;
          *(_DWORD *)(*(_DWORD *)(v71 + 4) + v76) = v78;
        }
        v76 += 4;
        v102 += 4;
      }
    }
    goto LABEL_71;
  }
  while ( v29 )
  {
LABEL_44:
    v26 = v29;
    if ( *(_DWORD *)v29 > v27 )
      goto LABEL_39;
LABEL_45:
    v29 = *(_DWORD *)(v26 + 12);
    if ( *(_DWORD *)(v26 + 4) < *(_DWORD *)v97 )
      goto LABEL_42;
  }
  Console__WriteLine((int)KernelConsole, (unsigned __int8 *)"Not linked!!!");
}
// C0102D00: using guessed type _DWORD __cdecl Heap__Malloc(_DWORD);

//----- (C0102BB0) --------------------------------------------------------
void __cdecl Heap__DeleteChunk(int a1)
{
  int v1; // eax@1
  int v2; // edx@3
  unsigned int v3; // edx@5
  int v4; // ebp@5
  unsigned int v5; // eax@6
  int v6; // ecx@8
  int i; // ecx@12
  int v8; // esi@13
  int v9; // edi@13

  v1 = *(_DWORD *)(a1 + 8);
  if ( v1 )
    *(_DWORD *)(v1 + 12) = *(_DWORD *)(a1 + 12);
  v2 = *(_DWORD *)(a1 + 12);
  if ( v2 )
    *(_DWORD *)(v2 + 8) = v1;
  v4 = vc010cd54;
  v3 = *(_DWORD *)(vc010cd54 + 8);
  if ( v3 )
  {
    v5 = 0;
    while ( 1 )
    {
      v6 = 0;
      if ( v5 < v3 )
        v6 = *(_DWORD *)(*(_DWORD *)(vc010cd54 + 4) + 4 * v5);
      if ( a1 == v6 )
        break;
      ++v5;
      if ( v5 == v3 )
        goto LABEL_15;
    }
    if ( v3 - 1 == v5 )
    {
      *(_DWORD *)(*(_DWORD *)(vc010cd54 + 4) + 4 * v5) = 0;
      *(_DWORD *)(v4 + 8) = v5;
    }
    else
    {
      for ( i = 4 * v5; v5 < v3; *(_DWORD *)v9 = *(_DWORD *)(v8 + i) )
      {
        v8 = *(_DWORD *)(v4 + 4);
        ++v5;
        v9 = v8 + i;
        i += 4;
      }
      *(_DWORD *)(v4 + 8) = v3 - 1;
    }
  }
LABEL_15:
  Heap__Free(a1);
}

//----- (C0102C60) --------------------------------------------------------
void __cdecl Heap__Unlink(int a1)
{
  int v1; // eax@2
  int v2; // edx@3
  int v3; // edx@7

  if ( a1 )
  {
    v1 = *(_DWORD *)(a1 + 8);
    if ( v1 || *(_DWORD *)(a1 + 4) )
    {
      v2 = *(_DWORD *)(a1 + 12);
      if ( !v2 )
        goto LABEL_6;
      if ( v2 >= (unsigned int)(*(_DWORD *)v2 - 16) )
      {
        if ( (unsigned int)(v2 - 4) > *(_DWORD *)(a1 + 4) )
          goto LABEL_6;
      }
      else
      {
        if ( *(_DWORD *)v2 > *(_DWORD *)(a1 + 4) )
          goto LABEL_6;
      }
      *(_DWORD *)(a1 + 4) = *(_DWORD *)(v2 + 4);
      Heap__DeleteChunk(v2);
      v1 = *(_DWORD *)(a1 + 8);
LABEL_6:
      if ( v1 )
      {
        v3 = *(_DWORD *)a1;
        if ( a1 >= (unsigned int)(*(_DWORD *)a1 - 16) )
          v3 = a1 - 4;
        if ( (unsigned int)v3 <= *(_DWORD *)(v1 + 4) )
        {
          *(_DWORD *)(v1 + 4) = *(_DWORD *)(a1 + 4);
          Heap__DeleteChunk(a1);
        }
      }
      return;
    }
  }
}

//----- (C0102D00) --------------------------------------------------------
int __cdecl Heap__Malloc(signed int a1)
{
  unsigned int v1; // ebx@3
  unsigned int v2; // eax@4
  int v3; // ecx@6
  int v4; // esi@8
  int v5; // edx@9
  int v6; // esi@11
  unsigned int v7; // ebx@12
  signed int v8; // edi@12
  int v9; // ecx@13
  int v10; // ebp@13
  int v11; // edx@15
  unsigned int v12; // eax@20
  int result; // eax@21
  int v14; // ecx@23
  unsigned int v15; // edi@23
  int v16; // eax@24
  unsigned int v17; // ebx@24
  unsigned int v18; // edx@26
  int v19; // eax@26
  unsigned int v20; // eax@33
  int v21; // esi@33
  int v22; // ebx@34
  int v23; // eax@35
  unsigned int v24; // ebx@36
  signed int v25; // edi@36
  int v26; // ecx@37
  int v27; // ebp@37
  int v28; // edx@39
  unsigned int v29; // eax@44
  int v30; // eax@47
  int v31; // eax@47
  int v32; // [sp+1Ch] [bp-30h]@17
  int v33; // [sp+1Ch] [bp-30h]@41
  int v34; // [sp+20h] [bp-2Ch]@12
  int v35; // [sp+24h] [bp-28h]@9
  int v36; // [sp+28h] [bp-24h]@10
  int v37; // [sp+28h] [bp-24h]@36
  int v38; // [sp+2Ch] [bp-20h]@23

  if ( !a1 )
    a1 = 4;
  v1 = *(_DWORD *)(vc010cd54 + 8);
  if ( !v1 )
  {
LABEL_23:
    v38 = vc010cd60;
    v14 = vc010cd60;
    v15 = (((unsigned int)(a1 + 24) >> 12) + 1) << 12;
    if ( v15 + vc010cd60 <= vc010cd5c )
    {
      v16 = vc010cd60;
      v17 = 0;
      while ( 1 )
      {
        v18 = v17++ << 12;
        v19 = Memory__Virtual__GetPage(v18 + v16, 1, vc010cd6c);
        Memory__Virtual__AllocateFrame(v19, 1, 1);
        if ( ((unsigned int)(a1 + 24) >> 12) + 1 <= v17 )
          break;
        v16 = vc010cd60;
      }
      v14 = v15 + vc010cd60;
      vc010cd60 += v15;
    }
    v5 = vc010cd50;
    if ( !vc010cd50 )
    {
      if ( *(_DWORD *)(vc010cd54 + 8) )
        v5 = **(_DWORD **)(vc010cd54 + 4);
    }
    while ( *(_DWORD *)(v5 + 12) )
      v5 = *(_DWORD *)(v5 + 12);
    if ( *(_DWORD *)(v5 + 4) == v38 )
    {
      *(_DWORD *)(v5 + 4) = v14;
      v4 = *(_DWORD *)v5;
      v35 = v5;
      goto LABEL_10;
    }
    *(_DWORD *)v38 = 16;
    v35 = v38 + 4;
    v21 = vc010cd54;
    *(_DWORD *)(v38 + 4) = v38 + 20;
    *(_DWORD *)(v38 + 8) = vc010cd60;
    v20 = *(_DWORD *)(v21 + 12);
    *(_DWORD *)(v38 + 16) = 0;
    *(_DWORD *)(v38 + 12) = v5;
    *(_DWORD *)(v5 + 12) = v38 + 4;
    if ( *(_DWORD *)(v21 + 8) >= v20 )
    {
      v31 = (v20 >> 1) + v20;
      *(_DWORD *)(v21 + 12) = v31;
      v22 = Heap__Malloc(4 * v31);
      Memory__Memory_Copy(v22, *(_DWORD *)(v21 + 4), 4 * *(_DWORD *)(v21 + 8));
      v30 = *(_DWORD *)(v21 + 4);
      *(_DWORD *)(v21 + 4) = v22;
      if ( !*(_BYTE *)(v21 + 16) )
      {
        *(_BYTE *)(v21 + 16) = 1;
LABEL_35:
        v23 = *(_DWORD *)(v21 + 8);
        *(_DWORD *)(v22 + 4 * v23) = v35;
        *(_DWORD *)(v21 + 8) = v23 + 1;
        if ( *(_DWORD *)v21 )
        {
          v37 = 0;
          v24 = 0;
          v25 = 4;
          while ( 1 )
          {
            v29 = *(_DWORD *)(v21 + 8);
            if ( v24 >= v29 - 1 )
              break;
            v27 = 0;
            v26 = *(_DWORD *)(v21 + 4);
            if ( v24 < v29 )
              v27 = *(_DWORD *)(v26 + v37);
            ++v24;
            v28 = 0;
            if ( v24 < v29 )
              v28 = *(_DWORD *)(v26 + v25);
            v33 = v28;
            if ( !(unsigned __int8)(*(int (__cdecl **)(int, int))v21)(v27, v28) )
            {
              *(_DWORD *)(*(_DWORD *)(v21 + 4) + v37) = v33;
              *(_DWORD *)(*(_DWORD *)(v21 + 4) + v25) = v27;
            }
            v25 += 4;
            v37 += 4;
          }
          v4 = *(_DWORD *)(v38 + 4);
          v5 = v38 + 4;
        }
        else
        {
          v5 = v38 + 4;
          v4 = *(_DWORD *)(v38 + 4);
        }
        goto LABEL_10;
      }
      Heap__Free(v30);
    }
    v22 = *(_DWORD *)(v21 + 4);
    goto LABEL_35;
  }
  v2 = 0;
  while ( 1 )
  {
    v3 = 0;
    if ( v2 < v1 )
      v3 = *(_DWORD *)(*(_DWORD *)(vc010cd54 + 4) + 4 * v2);
    v4 = *(_DWORD *)v3;
    if ( *(_DWORD *)(v3 + 4) - *(_DWORD *)v3 > (unsigned int)(a1 + 4) )
      break;
    ++v2;
    if ( v2 == v1 )
      goto LABEL_23;
  }
  v35 = v3;
  v5 = v3;
LABEL_10:
  *(_DWORD *)v4 = a1;
  v36 = *(_DWORD *)v5 + 4;
  *(_DWORD *)v5 = a1 + v36;
  if ( a1 + v36 == *(_DWORD *)(v5 + 4) )
  {
    Heap__DeleteChunk(v5);
    v35 = 0;
  }
  v6 = vc010cd54;
  if ( *vc010cd54 )
  {
    v8 = 4;
    v34 = 0;
    v7 = 0;
    while ( 1 )
    {
      v12 = *(_DWORD *)(v6 + 8);
      if ( v7 >= v12 - 1 )
        break;
      v10 = 0;
      v9 = *(_DWORD *)(v6 + 4);
      if ( v7 < v12 )
        v10 = *(_DWORD *)(v9 + v34);
      ++v7;
      v11 = 0;
      if ( v7 < v12 )
        v11 = *(_DWORD *)(v9 + v8);
      v32 = v11;
      if ( !(unsigned __int8)(*(int (__cdecl **)(int, int))v6)(v10, v11) )
      {
        *(_DWORD *)(*(_DWORD *)(v6 + 4) + v34) = v32;
        *(_DWORD *)(*(_DWORD *)(v6 + 4) + v8) = v10;
      }
      v8 += 4;
      v34 += 4;
    }
  }
  result = v36;
  vc010cd50 = v35;
  return result;
}
// C0102D00: using guessed type _DWORD __cdecl Heap__Malloc(_DWORD);
// C01038A0: using guessed type _DWORD __cdecl Memory__Virtual__GetPage(_DWORD, char, _DWORD);

//----- (C0103050) --------------------------------------------------------
int __cdecl Heap__Link(int a1, int a2, int a3)
{
  unsigned int v3; // eax@5
  unsigned int v4; // edx@5
  int v5; // esi@5
  int v6; // edi@6
  int result; // eax@7
  int (__cdecl *v8)(int, int); // edx@7
  unsigned int v9; // ebx@8
  int v10; // edi@8
  int v11; // ecx@9
  int v12; // ebp@9
  int v13; // edx@11
  int v14; // eax@18
  int v15; // edx@18
  int v16; // [sp+1Ch] [bp-20h]@13

  *(_DWORD *)(a3 + 8) = a1;
  *(_DWORD *)(a3 + 12) = a2;
  if ( a1 )
    *(_DWORD *)(a1 + 12) = a3;
  if ( a2 )
    *(_DWORD *)(a2 + 8) = a3;
  v5 = vc010cd54;
  v3 = *(_DWORD *)(vc010cd54 + 8);
  v4 = *(_DWORD *)(vc010cd54 + 12);
  if ( v3 >= v4 )
  {
    v15 = (v4 >> 1) + v4;
    *(_DWORD *)(vc010cd54 + 12) = v15;
    v6 = Heap__Malloc(4 * v15);
    Memory__Memory_Copy(v6, *(_DWORD *)(v5 + 4), 4 * *(_DWORD *)(v5 + 8));
    v14 = *(_DWORD *)(v5 + 4);
    *(_DWORD *)(v5 + 4) = v6;
    if ( *(_BYTE *)(v5 + 16) )
    {
      Heap__Free(v14);
      v6 = *(_DWORD *)(v5 + 4);
      v3 = *(_DWORD *)(v5 + 8);
    }
    else
    {
      *(_BYTE *)(v5 + 16) = 1;
      v3 = *(_DWORD *)(v5 + 8);
    }
  }
  else
  {
    v6 = *(_DWORD *)(vc010cd54 + 4);
  }
  *(_DWORD *)(v6 + 4 * v3) = a3;
  result = v3 + 1;
  v8 = *(int (__cdecl **)(int, int))v5;
  *(_DWORD *)(v5 + 8) = result;
  if ( v8 )
  {
    v10 = 0;
    v9 = 0;
    while ( v9 < result - 1 )
    {
      v12 = 0;
      v11 = *(_DWORD *)(v5 + 4);
      if ( result > v9 )
        v12 = *(_DWORD *)(v11 + v10);
      ++v9;
      v13 = 0;
      if ( result > v9 )
        v13 = *(_DWORD *)(v11 + 4 * v9);
      v16 = v13;
      if ( !(unsigned __int8)(*(int (__cdecl **)(int, int))v5)(v12, v13) )
      {
        *(_DWORD *)(*(_DWORD *)(v5 + 4) + v10) = v16;
        *(_DWORD *)(*(_DWORD *)(v5 + 4) + 4 * v9) = v12;
      }
      result = *(_DWORD *)(v5 + 8);
      v10 += 4;
    }
  }
  return result;
}
// C0102D00: using guessed type _DWORD __cdecl Heap__Malloc(_DWORD);

//----- (C0103150) --------------------------------------------------------
int __cdecl Heap__Setup()
{
  int v0; // eax@1
  int v1; // esi@2
  unsigned int v2; // eax@3
  unsigned int v3; // edx@3
  int v4; // ebx@3
  int v5; // eax@3
  int v6; // eax@3
  int v7; // edx@3
  int v8; // eax@4
  int v9; // ecx@4
  unsigned int v10; // ebx@5
  int v11; // edi@5
  int v12; // ecx@6
  int v13; // ebp@6
  int v14; // edx@8
  int v16; // eax@16
  int v17; // edx@16
  int v18; // [sp+18h] [bp-24h]@10
  int v19; // [sp+1Ch] [bp-20h]@3

  vc010cd64 = -268435456;
  vc010cd60 = -268435456;
  vc010cd58 = -268431360;
  vc010cd5c = -1;
  v0 = Memory__Virtual__GetPage(-268435456, 1, vc010cd6c);
  Memory__Virtual__AllocateFrame(v0, 1, 1);
  vc010cd60 += 4096;
  if ( vc010cd4c )
    v1 = Heap__Malloc(20);
  else
    v1 = Memory__StaticMalloc(20);
  *(_DWORD *)(v1 + 8) = 0;
  *(_DWORD *)(v1 + 12) = 4;
  *(_DWORD *)v1 = Heap__MemSortFunction;
  *(_BYTE *)(v1 + 16) = 0;
  v5 = Memory__StaticMalloc(16);
  *(_DWORD *)(v1 + 4) = v5;
  v4 = v5;
  vc010cd54 = v1;
  *vc010cd64 = 16;
  v6 = vc010cd64;
  v19 = vc010cd64 + 4;
  v7 = vc010cd64 + 20;
  vc010cd64 = v7;
  *(_DWORD *)(v6 + 4) = v7;
  *(_DWORD *)(v19 + 4) = vc010cd60;
  *(_DWORD *)(v19 + 8) = 0;
  *(_DWORD *)(v19 + 12) = 0;
  v2 = *(_DWORD *)(v1 + 8);
  v3 = *(_DWORD *)(v1 + 12);
  if ( v2 >= v3 )
  {
    v17 = (v3 >> 1) + v3;
    *(_DWORD *)(v1 + 12) = v17;
    v4 = Heap__Malloc(4 * v17);
    Memory__Memory_Copy(v4, *(_DWORD *)(v1 + 4), 4 * *(_DWORD *)(v1 + 8));
    v16 = *(_DWORD *)(v1 + 4);
    *(_DWORD *)(v1 + 4) = v4;
    if ( *(_BYTE *)(v1 + 16) )
    {
      Heap__Free(v16);
      v4 = *(_DWORD *)(v1 + 4);
      v2 = *(_DWORD *)(v1 + 8);
    }
    else
    {
      *(_BYTE *)(v1 + 16) = 1;
      v2 = *(_DWORD *)(v1 + 8);
    }
  }
  *(_DWORD *)(v4 + 4 * v2) = v19;
  v8 = v2 + 1;
  v9 = *(_DWORD *)v1;
  *(_DWORD *)(v1 + 8) = v8;
  if ( v9 )
  {
    v11 = 0;
    v10 = 0;
    while ( v10 < v8 - 1 )
    {
      v13 = 0;
      v12 = *(_DWORD *)(v1 + 4);
      if ( v8 > v10 )
        v13 = *(_DWORD *)(v12 + v11);
      ++v10;
      v14 = 0;
      if ( v8 > v10 )
        v14 = *(_DWORD *)(v12 + 4 * v10);
      v18 = v14;
      if ( !(unsigned __int8)(*(int (__cdecl **)(int, int))v1)(v13, v14) )
      {
        *(_DWORD *)(*(_DWORD *)(v1 + 4) + v11) = v18;
        *(_DWORD *)(*(_DWORD *)(v1 + 4) + 4 * v10) = v13;
      }
      v8 = *(_DWORD *)(v1 + 8);
      v11 += 4;
    }
  }
  vc010cd50 = v19;
  vc010cd4c = 1;
  return Log__Write("Heap allocated");
}
// C0101FC0: using guessed type _DWORD __cdecl Log__Write(_DWORD);
// C0102D00: using guessed type _DWORD __cdecl Heap__Malloc(_DWORD);
// C01038A0: using guessed type _DWORD __cdecl Memory__Virtual__GetPage(_DWORD, char, _DWORD);

//----- (C0103360) --------------------------------------------------------
int __cdecl Heap__Malloc_Allinged(int a1)
{
  unsigned int v1; // edx@2
  int v2; // esi@4
  unsigned int v3; // eax@6
  int v4; // ecx@6
  int v5; // ebp@8
  int v6; // edi@10
  int v7; // edx@11
  int v8; // ebx@11
  int v9; // ebx@12
  int v10; // ecx@12
  int v11; // eax@13
  int v12; // edx@13
  int v13; // eax@14
  unsigned int v14; // eax@16
  unsigned int v15; // edx@16
  int v16; // esi@16
  int v17; // ebx@17
  int v18; // eax@18
  int (__cdecl *v19)(int, int); // edx@18
  unsigned int v20; // ebx@19
  int v21; // edi@19
  int v22; // ecx@20
  int v23; // ebp@20
  int v24; // edx@22
  int v25; // esi@29
  unsigned int v26; // ebx@30
  signed int v27; // edi@30
  int v28; // ecx@31
  int v29; // ebp@31
  int v30; // edx@33
  unsigned int v31; // eax@38
  int v33; // eax@40
  int v34; // edx@40
  int v35; // ecx@45
  unsigned int v36; // ebp@45
  int v37; // edi@45
  int v38; // eax@46
  unsigned int v39; // ebx@46
  unsigned int v40; // edx@48
  int v41; // eax@48
  int v42; // edx@50
  unsigned int v43; // eax@55
  int v44; // esi@55
  int v45; // ebx@56
  int v46; // eax@57
  int (__cdecl *v47)(int, int); // ecx@57
  unsigned int v48; // ebx@58
  int v49; // edi@58
  int v50; // ecx@59
  int v51; // ebp@59
  int v52; // edx@61
  unsigned int v53; // eax@66
  int v54; // ebp@68
  int v55; // eax@72
  int v56; // eax@72
  int v57; // [sp+10h] [bp-2Ch]@24
  int v58; // [sp+10h] [bp-2Ch]@35
  int v59; // [sp+10h] [bp-2Ch]@63
  unsigned int v60; // [sp+14h] [bp-28h]@1
  int v61; // [sp+14h] [bp-28h]@11
  int v62; // [sp+14h] [bp-28h]@30
  int v63; // [sp+18h] [bp-24h]@2
  int v64; // [sp+18h] [bp-24h]@13
  int v65; // [sp+18h] [bp-24h]@55
  int v66; // [sp+1Ch] [bp-20h]@12

  v60 = *(_DWORD *)(vc010cd54 + 8);
  if ( !v60 )
  {
LABEL_45:
    v37 = vc010cd60;
    v35 = vc010cd60;
    v36 = (((unsigned int)(a1 + 24) >> 12) + 1) << 12;
    if ( v36 + vc010cd60 <= vc010cd5c )
    {
      v38 = vc010cd60;
      v39 = 0;
      while ( 1 )
      {
        v40 = v39++ << 12;
        v41 = Memory__Virtual__GetPage(v40 + v38, 1, vc010cd6c);
        Memory__Virtual__AllocateFrame(v41, 1, 1);
        if ( ((unsigned int)(a1 + 24) >> 12) + 1 <= v39 )
          break;
        v38 = vc010cd60;
      }
      v35 = v36 + vc010cd60;
      vc010cd60 += v36;
    }
    v42 = vc010cd50;
    if ( !vc010cd50 )
    {
      if ( *(_DWORD *)(vc010cd54 + 8) )
        v42 = **(_DWORD **)(vc010cd54 + 4);
    }
    while ( *(_DWORD *)(v42 + 12) )
      v42 = *(_DWORD *)(v42 + 12);
    if ( *(_DWORD *)(v42 + 4) == v37 )
    {
      *(_DWORD *)(v42 + 4) = v35;
      v61 = v42;
LABEL_68:
      v4 = 0;
      v54 = *(_DWORD *)v61;
      if ( *(_DWORD *)v61 & 0xFFFFF000 )
      {
        LOWORD(v4) = 4096;
        v4 -= v54 & 0xFFF;
      }
      v5 = v54 - 4;
      v8 = a1;
      v6 = v4 + a1 + 4;
      v7 = v61;
      goto LABEL_12;
    }
    *(_DWORD *)v37 = 16;
    v44 = vc010cd54;
    *(_DWORD *)(v37 + 4) = v37 + 20;
    *(_DWORD *)(v37 + 8) = vc010cd60;
    v43 = *(_DWORD *)(v44 + 12);
    *(_DWORD *)(v37 + 16) = 0;
    v65 = v37 + 4;
    *(_DWORD *)(v37 + 12) = v42;
    *(_DWORD *)(v42 + 12) = v37 + 4;
    if ( *(_DWORD *)(v44 + 8) >= v43 )
    {
      v56 = (v43 >> 1) + v43;
      *(_DWORD *)(v44 + 12) = v56;
      v45 = Heap__Malloc(4 * v56);
      Memory__Memory_Copy(v45, *(_DWORD *)(v44 + 4), 4 * *(_DWORD *)(v44 + 8));
      v55 = *(_DWORD *)(v44 + 4);
      *(_DWORD *)(v44 + 4) = v45;
      if ( !*(_BYTE *)(v44 + 16) )
      {
        *(_BYTE *)(v44 + 16) = 1;
LABEL_57:
        v46 = *(_DWORD *)(v44 + 8);
        v61 = v37 + 4;
        *(_DWORD *)(v45 + 4 * v46) = v65;
        v47 = *(int (__cdecl **)(int, int))v44;
        *(_DWORD *)(v44 + 8) = v46 + 1;
        if ( v47 )
        {
          v49 = 0;
          v48 = 0;
          while ( 1 )
          {
            v53 = *(_DWORD *)(v44 + 8);
            if ( v48 >= v53 - 1 )
              break;
            v51 = 0;
            v50 = *(_DWORD *)(v44 + 4);
            if ( v48 < v53 )
              v51 = *(_DWORD *)(v50 + v49);
            ++v48;
            v52 = 0;
            if ( v48 < v53 )
              v52 = *(_DWORD *)(v50 + 4 * v48);
            v59 = v52;
            if ( !(unsigned __int8)(*(int (__cdecl **)(int, int))v44)(v51, v52) )
            {
              *(_DWORD *)(*(_DWORD *)(v44 + 4) + v49) = v59;
              *(_DWORD *)(*(_DWORD *)(v44 + 4) + 4 * v48) = v51;
            }
            v49 += 4;
          }
          v61 = v65;
        }
        goto LABEL_68;
      }
      Heap__Free(v55);
    }
    v45 = *(_DWORD *)(v44 + 4);
    goto LABEL_57;
  }
  v63 = a1 - 4;
  v1 = 0;
  while ( 1 )
  {
    v2 = 0;
    if ( v60 > v1 )
      v2 = *(_DWORD *)(*(_DWORD *)(vc010cd54 + 4) + 4 * v1);
    v3 = *(_DWORD *)v2;
    v4 = 0;
    if ( *(_DWORD *)v2 & 0xFFFFF000 )
      v4 = 4096 - (v3 & 0xFFF);
    v5 = v3 - 4;
    if ( v3 > v4 + v3 - 4 )
      v4 = 8192 - (v3 & 0xFFF);
    v6 = v4 + v63;
    if ( v4 + v63 <= *(_DWORD *)(v2 + 4) - v3 )
      break;
    ++v1;
    if ( v1 == v60 )
      goto LABEL_45;
  }
  v61 = v2;
  v8 = a1;
  v7 = v2;
LABEL_12:
  *(_DWORD *)(v5 + v4) = v8;
  v9 = *(_DWORD *)v7;
  v10 = *(_DWORD *)v7 + v4;
  *(_DWORD *)v7 += v6;
  v66 = v10;
  if ( vc010cd4c )
  {
    v11 = Heap__Malloc(16);
    v64 = v11;
    v12 = v11;
  }
  else
  {
    v11 = Memory__StaticMalloc(16);
    v64 = v11;
    v12 = v11;
  }
  *(_DWORD *)v11 = v9;
  *(_DWORD *)(v12 + 12) = v61;
  *(_DWORD *)(v12 + 4) = v66 - 4;
  *(_DWORD *)(v12 + 8) = *(_DWORD *)(v61 + 8);
  *(_DWORD *)(v61 + 8) = v12;
  v13 = *(_DWORD *)(v12 + 8);
  if ( v13 )
    *(_DWORD *)(v13 + 12) = v12;
  v16 = vc010cd54;
  v14 = *(_DWORD *)(vc010cd54 + 8);
  v15 = *(_DWORD *)(vc010cd54 + 12);
  if ( v14 >= v15 )
  {
    v34 = (v15 >> 1) + v15;
    *(_DWORD *)(vc010cd54 + 12) = v34;
    v17 = Heap__Malloc(4 * v34);
    Memory__Memory_Copy(v17, *(_DWORD *)(v16 + 4), 4 * *(_DWORD *)(v16 + 8));
    v33 = *(_DWORD *)(v16 + 4);
    *(_DWORD *)(v16 + 4) = v17;
    if ( *(_BYTE *)(v16 + 16) )
    {
      Heap__Free(v33);
      v17 = *(_DWORD *)(v16 + 4);
      v14 = *(_DWORD *)(v16 + 8);
    }
    else
    {
      *(_BYTE *)(v16 + 16) = 1;
      v14 = *(_DWORD *)(v16 + 8);
    }
  }
  else
  {
    v17 = *(_DWORD *)(vc010cd54 + 4);
  }
  *(_DWORD *)(v17 + 4 * v14) = v64;
  v18 = v14 + 1;
  v19 = *(int (__cdecl **)(int, int))v16;
  *(_DWORD *)(v16 + 8) = v18;
  if ( v19 )
  {
    v21 = 0;
    v20 = 0;
    while ( v20 < v18 - 1 )
    {
      v23 = 0;
      v22 = *(_DWORD *)(v16 + 4);
      if ( v18 > v20 )
        v23 = *(_DWORD *)(v22 + v21);
      ++v20;
      v24 = 0;
      if ( v18 > v20 )
        v24 = *(_DWORD *)(v22 + 4 * v20);
      v57 = v24;
      if ( !(unsigned __int8)(*(int (__cdecl **)(int, int))v16)(v23, v24) )
      {
        *(_DWORD *)(*(_DWORD *)(v16 + 4) + v21) = v57;
        *(_DWORD *)(*(_DWORD *)(v16 + 4) + 4 * v20) = v23;
      }
      v18 = *(_DWORD *)(v16 + 8);
      v21 += 4;
    }
  }
  Heap__Unlink(v64);
  if ( *(_DWORD *)(v61 + 4) == *(_DWORD *)v61 )
    Heap__DeleteChunk(v61);
  v25 = vc010cd54;
  if ( *vc010cd54 )
  {
    v27 = 4;
    v62 = 0;
    v26 = 0;
    while ( 1 )
    {
      v31 = *(_DWORD *)(v25 + 8);
      if ( v26 >= v31 - 1 )
        break;
      v29 = 0;
      v28 = *(_DWORD *)(v25 + 4);
      if ( v26 < v31 )
        v29 = *(_DWORD *)(v28 + v62);
      ++v26;
      v30 = 0;
      if ( v26 < v31 )
        v30 = *(_DWORD *)(v28 + v27);
      v58 = v30;
      if ( !(unsigned __int8)(*(int (__cdecl **)(int, int))v25)(v29, v30) )
      {
        *(_DWORD *)(*(_DWORD *)(v25 + 4) + v62) = v58;
        *(_DWORD *)(*(_DWORD *)(v25 + 4) + v27) = v29;
      }
      v27 += 4;
      v62 += 4;
    }
  }
  vc010cd50 = v64;
  return v66;
}
// C0102D00: using guessed type _DWORD __cdecl Heap__Malloc(_DWORD);
// C01038A0: using guessed type _DWORD __cdecl Memory__Virtual__GetPage(_DWORD, char, _DWORD);

//----- (C0103800) --------------------------------------------------------
int __cdecl operator new(int a1)
{
  int result; // eax@2

  if ( vc010cd4c )
    result = Heap__Malloc(a1);
  else
    result = Memory__StaticMalloc(a1);
  return result;
}
// C0102D00: using guessed type _DWORD __cdecl Heap__Malloc(_DWORD);

//----- (C0103830) --------------------------------------------------------
int __cdecl operator new__(int a1)
{
  int result; // eax@2

  if ( vc010cd4c )
    result = Heap__Malloc(a1);
  else
    result = Memory__StaticMalloc(a1);
  return result;
}
// C0102D00: using guessed type _DWORD __cdecl Heap__Malloc(_DWORD);

//----- (C0103880) --------------------------------------------------------
int __cdecl Memory__Virtual__Switch(int a1)
{
  int result; // eax@1

  vc010cd68 = a1;
  result = *(_DWORD *)(a1 + 8192);
  __asm { mov     cr3, eax }
  return result;
}

//----- (C01038A0) --------------------------------------------------------
int __cdecl Memory__Virtual__GetPage(unsigned int a1, char a2, int a3)
{
  int v3; // eax@1
  unsigned int v4; // edi@1
  unsigned int v5; // esi@1
  int result; // eax@2
  int v7; // eax@6
  int v8; // ecx@6
  int v9; // eax@8
  int v10; // [sp+1Ch] [bp-20h]@6

  v5 = a1 >> 22;
  v4 = a1 >> 12;
  v3 = *(_DWORD *)(a3 + 4 * (a1 >> 22));
  if ( v3 )
  {
    result = v3 + 4 * (v4 & 0x3FF);
  }
  else
  {
    result = 0;
    if ( a2 )
    {
      if ( vc010cd4c )
      {
        v9 = Heap__Malloc_Allinged(4096);
        *(_DWORD *)(a3 + 4 * v5) = v9;
        v10 = (v9 & 0xFFF) + (*(_DWORD *)Memory__Virtual__GetPage(v9, 0, a3) & 0xFFFFF000);
        v7 = *(_DWORD *)(a3 + 4 * v5);
      }
      else
      {
        v7 = Memory__StaticMalloc(4096, 1, (int)&v10);
        v8 = v10 + 1073741824;
        *(_DWORD *)(a3 + 4 * v5) = v7;
        v10 = v8;
      }
      Memory__Memory_Clear(v7, 4096);
      *(_DWORD *)(a3 + 4 * v5 + 4096) = v10 | 7;
      result = *(_DWORD *)(a3 + 4 * v5) + 4 * (v4 & 0x3FF);
    }
  }
  return result;
}
// C01038A0: using guessed type _DWORD __cdecl Memory__Virtual__GetPage(_DWORD, char, _DWORD);

//----- (C01039A0) --------------------------------------------------------
int __cdecl Memory__Virtual__Install()
{
  int v0; // eax@1
  signed int v1; // ebx@1
  int v2; // eax@1
  int v3; // eax@3
  int v4; // edi@5
  int v5; // edx@6
  int v6; // ecx@7
  unsigned int v7; // edi@10
  int v11; // [sp+2Ch] [bp-20h]@1

  v2 = Memory__StaticMalloc(0);
  Memory__Memory_Clear(v2, 1048576);
  vc010cd70 = 65536;
  vc010cd74 = Memory__StaticMalloc(8192);
  Memory__Memory_Clear(vc010cd74, vc010cd70 >> 3);
  v11 = 0;
  vc010cd6c = Memory__StaticMalloc(8196, 1, (int)&v11);
  v11 += 1073741824;
  Memory__Memory_Clear(vc010cd6c, 8196);
  v0 = vc010cd6c;
  v1 = -1073741824;
  *(_DWORD *)(vc010cd6c + 8192) = v11 + 4096;
  do
  {
    v3 = Memory__Virtual__GetPage(v1, 1, v0);
    if ( !(*(_DWORD *)v3 & 0xFFFFF000) )
    {
      if ( vc010cd70 >> 5 )
      {
        v4 = 0;
        while ( 1 )
        {
          v5 = *(_DWORD *)(vc010cd74 + 4 * v4);
          if ( v5 != -1 )
            break;
LABEL_11:
          ++v4;
          if ( v4 == vc010cd70 >> 5 )
            goto LABEL_12;
        }
        v6 = 0;
        while ( v5 & (1 << v6) )
        {
          ++v6;
          if ( v6 == 32 )
            goto LABEL_11;
        }
        v7 = (v6 + 32 * v4) << 12;
        *(_DWORD *)(vc010cd74 + 4 * (v7 >> 17)) |= 1 << (v7 >> 12);
        *(_BYTE *)v3 = (*(_BYTE *)v3 | 3) & 0xFB;
        *(_DWORD *)v3 = v7 | *(_DWORD *)v3 & 0xFFF;
      }
      else
      {
LABEL_12:
        *(_BYTE *)v3 &= 0xFEu;
      }
    }
    v1 += 4096;
    v0 = vc010cd6c;
  }
  while ( v1 != -1071644672 );
  vc010cd68 = vc010cd6c;
  _EAX = *(_DWORD *)(vc010cd6c + 8192);
  __asm { mov     cr3, eax }
  return Heap__Setup();
}
// C01038A0: using guessed type _DWORD __cdecl Memory__Virtual__GetPage(_DWORD, char, _DWORD);

//----- (C0103B50) --------------------------------------------------------
int __cdecl Memory__Virtual__SetFrame(unsigned int a1)
{
  int result; // eax@1

  result = vc010cd74 + 4 * (a1 >> 17);
  *(_DWORD *)result |= 1 << (a1 >> 12);
  return result;
}

//----- (C0103B70) --------------------------------------------------------
signed int __cdecl Memory__Virtual__ClearFrame(unsigned int a1)
{
  signed int result; // eax@1

  result = ~(1 << (a1 >> 12));
  *(_DWORD *)(vc010cd74 + 4 * (a1 >> 17)) &= result;
  return result;
}

//----- (C0103BA0) --------------------------------------------------------
char __cdecl Memory__Virtual__TestFrame(unsigned int a1)
{
  return ((1 << (a1 >> 12)) & *(_DWORD *)(vc010cd74 + 4 * (a1 >> 17))) != 0;
}

//----- (C0103BC0) --------------------------------------------------------
int __cdecl Memory__Virtual__FirstFrame()
{
  int result; // eax@1
  int v1; // ebx@2
  int v2; // edx@3
  int v3; // ecx@4

  result = -1;
  if ( vc010cd70 >> 5 )
  {
    v1 = 0;
    while ( 1 )
    {
      v2 = *(_DWORD *)(vc010cd74 + 4 * v1);
      if ( v2 != -1 )
        break;
LABEL_9:
      ++v1;
      if ( v1 == vc010cd70 >> 5 )
        return -1;
    }
    v3 = 0;
    while ( v2 & (1 << v3) )
    {
      ++v3;
      if ( v3 == 32 )
        goto LABEL_9;
    }
    result = v3 + 32 * v1;
  }
  return result;
}

//----- (C0103C20) --------------------------------------------------------
char __cdecl Memory__Virtual__AllocateFrame(int a1, char a2, char a3)
{
  int v3; // eax@1
  int v4; // esi@4
  int v5; // ecx@6
  unsigned int v6; // esi@9

  LOBYTE(v3) = a3;
  if ( !(*(_DWORD *)a1 & 0xFFFFF000) )
  {
    v3 = vc010cd70 >> 5;
    if ( vc010cd70 >> 5 )
    {
      v4 = 0;
      while ( 1 )
      {
        v3 = *(_DWORD *)(vc010cd74 + 4 * v4);
        if ( v3 != -1 )
          break;
LABEL_10:
        ++v4;
        if ( v4 == vc010cd70 >> 5 )
          goto LABEL_11;
      }
      v5 = 0;
      while ( v3 & (1 << v5) )
      {
        ++v5;
        if ( v5 == 32 )
          goto LABEL_10;
      }
      v6 = (v5 + 32 * v4) << 12;
      *(_DWORD *)(vc010cd74 + 4 * (v6 >> 17)) |= 1 << (v6 >> 12);
      *(_BYTE *)a1 = 4 * ((a2 ^ 1) & 1) | 2 * (a3 & 1) | (*(_BYTE *)a1 | 1) & 0xF9;
      v3 = v6 | *(_DWORD *)a1 & 0xFFF;
      *(_DWORD *)a1 = v3;
    }
    else
    {
LABEL_11:
      *(_BYTE *)a1 &= 0xFEu;
    }
  }
  return v3;
}

//----- (C0103D10) --------------------------------------------------------
int __cdecl Memory__Virtual__FreeFrame(int a1)
{
  int result; // eax@1
  int v2; // edx@2

  result = a1;
  if ( *(_DWORD *)a1 & 0xFFFFF000 )
  {
    *(_DWORD *)(vc010cd74 + 4 * (*(_DWORD *)a1 >> 29)) &= ~(1 << (*(_DWORD *)a1 >> 24));
    *(_BYTE *)a1 &= 0xFEu;
    v2 = *(_DWORD *)a1 & 0xFFF;
    *(_DWORD *)a1 = v2;
    *(_BYTE *)a1 = v2 & 0xF9;
  }
  return result;
}

//----- (C0103D60) --------------------------------------------------------
int __cdecl Memory__Virtual__CreateCopy(int a1)
{
  int v1; // ebx@1
  int v2; // edi@1
  int v3; // esi@2

  v1 = 0;
  v2 = Heap__Malloc_Allinged(8196);
  Memory__Memory_Clear(v2, 8196);
  *(_DWORD *)(v2 + 8192) = (*(_DWORD *)Memory__Virtual__GetPage(v2, 0, vc010cd6c) & 0xFFFFF000) + (v2 & 0xFFF) + 4096;
  do
  {
    v3 = *(_DWORD *)(a1 + 4 * v1);
    if ( v3 )
    {
      *(_DWORD *)(v2 + 4 * v1) = v3;
      *(_DWORD *)(v2 + 4 * v1 + 4096) = ((*(_DWORD *)Memory__Virtual__GetPage(v3, 0, vc010cd6c) & 0xFFFFF000)
                                       + (v3 & 0xFFF)) | 7;
    }
    ++v1;
  }
  while ( v1 != 1024 );
  return v2;
}
// C01038A0: using guessed type _DWORD __cdecl Memory__Virtual__GetPage(_DWORD, char, _DWORD);

//----- (C0103E10) --------------------------------------------------------
int __cdecl Memory__Virtual__LogicToPhysical(int a1, int a2)
{
  return (a1 & 0xFFF) + (*(_DWORD *)Memory__Virtual__GetPage(a1, 0, a2) & 0xFFFFF000);
}
// C01038A0: using guessed type _DWORD __cdecl Memory__Virtual__GetPage(_DWORD, char, _DWORD);

//----- (C0103E50) --------------------------------------------------------
int __cdecl GDT__Install()
{
  vc010cd78 = 23;
  vc010cd7a = GDT__Entries;
  vc010cd82 = 0;
  vc010cd84 = 0;
  vc010cd87 = 0;
  vc010cd80 = 0;
  vc010cd86 = 0;
  vc010cd85 = 0;
  vc010cd8a = 0;
  vc010cd8c = 0;
  vc010cd8f = 0;
  vc010cd88 = -1;
  vc010cd8e = -49;
  vc010cd8d = -102;
  vc010cd92 = 0;
  vc010cd94 = 0;
  vc010cd97 = 0;
  vc010cd90 = -1;
  vc010cd96 = -49;
  vc010cd95 = -110;
  return GDT_Flush(GDT__Pointer);
}

//----- (C0103F00) --------------------------------------------------------
int __cdecl GDT__SetGate(int a1, unsigned int a2, unsigned int a3, char a4, char a5)
{
  int result; // eax@1

  result = a1;
  *(_BYTE *)(8 * a1 - 1072640892) = a2 >> 16;
  *(_WORD *)(8 * a1 - 1072640894) = a2;
  *(_WORD *)(8 * a1 - 1072640896) = a3;
  *(_BYTE *)(8 * a1 - 1072640890) = (a3 >> 16) & 0xF | a5 & 0xF0;
  *(_BYTE *)(8 * a1 - 1072640889) = a2 >> 24;
  *(_BYTE *)(8 * a1 - 1072640891) = a4;
  return result;
}

//----- (C0103F60) --------------------------------------------------------
int __cdecl GDT__Flush()
{
  return GDT_Flush(GDT__Pointer);
}

//----- (C0103F90) --------------------------------------------------------
void __cdecl kmain()
{
  Memory__Virtual__Install();
  Log__Install();
  GDT__Install();
  IDT__Install();
  PIT__Install();
  Keyboard__Install();
  Log__Write("All subsystem initialised");
  Graphics__Initialise_NoGraphics();
  Console__Initialise_NoGraphics(KernelConsole);
  Graphics__SetConsole(KernelConsole);
  Console__WriteLineSubsystem((int)KernelConsole, (unsigned __int8 *)"Succesful boot", (unsigned __int8 *)"Kernel", 1);
  while ( 1 )
  {
    Console__WriteLineSubsystem((int)KernelConsole, (unsigned __int8 *)"Succesful boot", (unsigned __int8 *)"Kernel", 1);
    PIT__Sleep(1000);
  }
}
// C01018D0: using guessed type _DWORD __cdecl Console__Initialise_NoGraphics(_DWORD);
// C0101FC0: using guessed type _DWORD __cdecl Log__Write(_DWORD);
// C0102190: using guessed type _DWORD __cdecl PIT__Sleep(_DWORD);
// C0104060: using guessed type _DWORD __cdecl Graphics__SetConsole(_DWORD);

//----- (C0104040) --------------------------------------------------------
void __cdecl Graphics__Initialise_NoGraphics()
{
  vc010cdb8 = -1072988160;
  vc010cdb4 = 8;
}

//----- (C0104060) --------------------------------------------------------
int __cdecl Graphics__SetConsole(int a1)
{
  int result; // eax@1

  result = a1;
  vc010cdb0 = a1;
  *(_BYTE *)(a1 + 21) = 1;
  return result;
}
// C0104060: using guessed type _DWORD __cdecl Graphics__SetConsole(_DWORD);

//----- (C0104070) --------------------------------------------------------
int __cdecl Graphics__GetConsole()
{
  return vc010cdb0;
}

//----- (C0104080) --------------------------------------------------------
void __cdecl Graphics__RefreshConsole()
{
  unsigned int *v0; // ecx@1
  unsigned int v1; // eax@2
  int v2; // edx@2
  unsigned int v3; // ecx@2
  int v4; // esi@3
  unsigned int v5; // edi@5
  int v6; // edx@8
  int v7; // ecx@8

  v0 = (unsigned int *)vc010cdb0;
  if ( *(_BYTE *)(vc010cdb0 + 21) )
  {
    v1 = *(_DWORD *)(vc010cdb0 + 4) * *(_DWORD *)(vc010cdb0 + 8);
    *(_BYTE *)(vc010cdb0 + 21) = 0;
    v2 = vc010cdb8;
    v3 = *v0;
    if ( v1 )
    {
      v4 = 2 * (v1 >> 1);
      if ( !(2 * (v1 >> 1))
        || !((v3 > vc010cdb8 + 4 | vc010cdb8 > v3 + 4) & (((_BYTE)v3 | vc010cdb8) & 3) == 0 & v1 > 0xC) )
      {
        v4 = 0;
LABEL_8:
        v7 = -2 * v4 + v3;
        v6 = -2 * v4 + v2;
        do
        {
          *(_WORD *)(v6 + 2 * v4) = *(_WORD *)(v7 + 2 * v4);
          ++v4;
        }
        while ( v1 > v4 );
        return;
      }
      v5 = 0;
      do
      {
        *(_DWORD *)(v2 + 4 * v5) = *(_DWORD *)(v3 + 4 * v5);
        ++v5;
      }
      while ( v1 >> 1 > v5 );
      v2 += 4 * (v1 >> 1);
      v3 += 4 * (v1 >> 1);
      if ( v1 != v4 )
        goto LABEL_8;
    }
  }
}

//----- (C0104140) --------------------------------------------------------
char __usercall Keyboard__ToUpper<al>(int a1<eax>, char a2)
{
  LOBYTE(a1) = a2;
  if ( (unsigned __int8)(a2 - 97) <= 0x19u )
    a1 -= 32;
  return a1;
}

//----- (C0104150) --------------------------------------------------------
char __usercall Keyboard__ToLower<al>(int a1<eax>, char a2)
{
  LOBYTE(a1) = a2;
  if ( (unsigned __int8)(a2 - 65) <= 0x19u )
    a1 += 32;
  return a1;
}

//----- (C0104160) --------------------------------------------------------
char __cdecl Keyboard__ShiftUp(int a1)
{
  int v1; // eax@1

  v1 = a1;
  if ( (unsigned __int8)(a1 - 97) <= 0x19u )
    v1 = a1 - 32;
  switch ( v1 )
  {
    case 47:
      LOBYTE(v1) = 63;
      break;
    case 40:
    case 41:
    case 42:
    case 43:
    case 58:
    case 60:
    case 62:
    case 63:
    case 64:
    case 65:
    case 66:
    case 67:
    case 68:
    case 69:
    case 70:
    case 71:
    case 72:
    case 73:
    case 74:
    case 75:
    case 76:
    case 77:
    case 78:
    case 79:
    case 80:
    case 81:
    case 82:
    case 83:
    case 84:
    case 85:
    case 86:
    case 87:
    case 88:
    case 89:
    case 90:
    case 94:
    case 95:
      return v1;
    case 96:
      LOBYTE(v1) = 126;
      break;
    case 93:
      LOBYTE(v1) = 125;
      break;
    case 92:
      LOBYTE(v1) = 124;
      break;
    case 91:
      LOBYTE(v1) = 123;
      break;
    case 61:
      LOBYTE(v1) = 43;
      break;
    case 59:
      LOBYTE(v1) = 58;
      break;
    case 57:
      LOBYTE(v1) = 40;
      break;
    case 56:
      LOBYTE(v1) = 42;
      break;
    case 55:
      LOBYTE(v1) = 38;
      break;
    case 54:
      LOBYTE(v1) = 94;
      break;
    case 53:
      LOBYTE(v1) = 37;
      break;
    case 52:
      LOBYTE(v1) = 36;
      break;
    case 51:
      LOBYTE(v1) = 35;
      break;
    case 50:
      LOBYTE(v1) = 64;
      break;
    case 49:
      LOBYTE(v1) = 33;
      break;
    case 48:
      LOBYTE(v1) = 41;
      break;
    case 46:
      LOBYTE(v1) = 62;
      break;
    case 45:
      LOBYTE(v1) = 95;
      break;
    case 44:
      LOBYTE(v1) = 60;
      break;
    case 39:
      LOBYTE(v1) = 34;
      break;
  }
  return v1;
}

//----- (C01042F0) --------------------------------------------------------
#error "C01043A5: switch analysis failed (funcsize=86)"

//----- (C01044A0) --------------------------------------------------------
char __cdecl Keyboard__ReadKey()
{
  int v0; // eax@1
  int v2; // ebx@3
  int v3; // eax@3

  vc010cdc0 = 1;
  v0 = *(_DWORD *)(vc010cdc4 + 4);
  if ( v0 == *(_DWORD *)(vc010cdc4 + 8) )
    Globals__HLT();
  v2 = v0 + *vc010cdc4;
  *(_DWORD *)(vc010cdc4 + 4) = (unsigned int)(v0 + 1) % *(_DWORD *)(vc010cdc4 + 12);
  LOBYTE(v2) = *(_BYTE *)v2;
  v3 = Graphics__GetConsole();
  Console__Write(v3, v2);
  vc010cdc0 = 0;
  return v2;
}
// C01018C0: using guessed type int Globals__HLT(void);

//----- (C0104510) --------------------------------------------------------
char __cdecl Keyboard__ReadKeyInternal()
{
  int v0; // eax@1
  int v2; // ebx@3
  int v3; // eax@3

  v0 = *(_DWORD *)(vc010cdc4 + 4);
  if ( v0 == *(_DWORD *)(vc010cdc4 + 8) )
    Globals__HLT();
  v2 = v0 + *vc010cdc4;
  *(_DWORD *)(vc010cdc4 + 4) = (unsigned int)(v0 + 1) % *(_DWORD *)(vc010cdc4 + 12);
  LOBYTE(v2) = *(_BYTE *)v2;
  v3 = Graphics__GetConsole();
  Console__Write(v3, v2);
  return v2;
}
// C01018C0: using guessed type int Globals__HLT(void);

//----- (C0104570) --------------------------------------------------------
__int16 __cdecl Keyboard__ReadFullKey()
{
  vc010cdc0 = 1;
  vc010cdc8 = 0;
  if ( !vc010cdc8 )
    Globals__HLT();
  vc010cdc0 = 0;
  return vc010cdc8;
}
// C01018C0: using guessed type int Globals__HLT(void);

//----- (C01045C0) --------------------------------------------------------
unsigned __int8 __cdecl Keyboard__ReadLine(int a1)
{
  int v1; // ebx@1
  int v2; // esi@1
  int v3; // eax@3
  unsigned __int8 result; // al@4
  int v5; // edi@4
  int v6; // eax@4
  unsigned __int8 v7; // [sp+1Fh] [bp-1Dh]@4

  v1 = 0;
  vc010cdc0 = 1;
  v2 = a1;
  while ( 1 )
  {
    v3 = *(_DWORD *)(vc010cdc4 + 4);
    if ( v3 == *(_DWORD *)(vc010cdc4 + 8) )
      Globals__HLT();
    v5 = v3 + *vc010cdc4;
    *(_DWORD *)(vc010cdc4 + 4) = (unsigned int)(v3 + 1) % *(_DWORD *)(vc010cdc4 + 12);
    v7 = *(_BYTE *)v5;
    v6 = Graphics__GetConsole();
    Console__Write(v6, v7);
    result = v7;
    *(_BYTE *)v2 = v7;
    if ( v7 == 10 )
      break;
    if ( v7 != 127 && v7 != 8 )
    {
      ++v1;
      v2 = a1 + v1;
    }
    else
    {
      if ( v1 )
      {
        --v1;
        *(_BYTE *)v2 = 0;
        v2 = a1 + v1;
      }
      else
      {
        *(_BYTE *)a1 = 0;
      }
    }
  }
  *(_BYTE *)v2 = 0;
  vc010cdc0 = 0;
  return result;
}
// C01018C0: using guessed type int Globals__HLT(void);

//----- (C0104680) --------------------------------------------------------
int __cdecl Keyboard__Install()
{
  int result; // eax@1
  int v1; // eax@1
  int v2; // ebx@1
  int v3; // eax@1

  v1 = operator new(16);
  v2 = v1;
  *(_DWORD *)(v1 + 12) = 32;
  v3 = operator new__(32);
  *(_DWORD *)(v2 + 8) = 0;
  *(_DWORD *)v2 = v3;
  *(_DWORD *)(v2 + 4) = 0;
  vc010cdc4 = v2;
  result = IDT__InstallHandler(1, (int)Keyboard__KeyboardHandler);
  vc010cdc0 = 0;
  return result;
}
// C01042F0: using guessed type int Keyboard__KeyboardHandler();

#error "There were 2 decompilation failure(s) on 95 function(s)"
